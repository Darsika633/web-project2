openapi: 3.0.3
info:
  title: TrendBite API
  description: |
    A comprehensive API for TrendBite - Online Cloth Store
    
    ## Features
    - User Registration and Authentication
    - Password Reset via Email (Token-based, 1-hour expiry)
    - Profile Management with Cloudinary Image Upload
    - Role-based Access Control (Customer/Admin/Delivery Person)
    - Secure JWT Authentication
    - Comprehensive User Management
    - Product & Inventory Management
    - Order Processing & Tracking
    - Delivery Person Rating System
    - Payment Management (COD Support)
    - Review & Feedback System
    
    ## Authentication
    This API uses JWT (JSON Web Tokens) for authentication. Include the token in the Authorization header:
    ```
    Authorization: Bearer <your-jwt-token>
    ```
    
    ## User Roles
    - **Customer**: Default role for regular users
    - **Admin**: Administrative access to manage users and system
    - **Delivery Person**: Delivery personnel with order delivery capabilities
    
    ## Rate Limiting
    API requests are rate limited to prevent abuse. Current limits:
    - 100 requests per 15 minutes per IP address
    
  version: 1.0.0
  contact:
    name: TrendBite Support
    email: support@trendbite.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:3000/api
    description: Development server
  - url: https://trendbite-api.onrender.com/api
    description: Production server

tags:
  - name: Users
    description: User management and authentication
  - name: Products
    description: Product management and operations
  - name: Categories
    description: Category management and operations
  - name: Orders
    description: Order management and tracking
  - name: Discounts
    description: Discount code management
  - name: Reviews
    description: Review and feedback management
  - name: Cart
    description: Shopping cart management
  - name: Admin Dashboard
    description: Admin dashboard analytics and statistics
  - name: Delivery
    description: Delivery management and tracking
  - name: Health
    description: Health check endpoints
  - name: Inventory
    description: Inventory management and stock tracking
  - name: Payments
    description: COD payment management and tracking

paths:
  # Admin Dashboard Endpoints
  /admin/dashboard/overview:
    get:
      summary: Get dashboard overview statistics
      description: Retrieve key metrics for the admin dashboard including total orders, revenue, pending orders, and average order value
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Dashboard overview retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      totalOrders:
                        type: integer
                        example: 1250
                      totalRevenue:
                        type: number
                        example: 125000.50
                      pendingOrders:
                        type: integer
                        example: 45
                      averageOrderValue:
                        type: number
                        example: 100.00
                      totalCustomers:
                        type: integer
                        example: 850
                      totalProducts:
                        type: integer
                        example: 120
                      totalReviews:
                        type: integer
                        example: 340
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /admin/dashboard/revenue-overview:
    get:
      summary: Get monthly revenue for past 6 months
      description: Retrieve monthly revenue breakdown for the past 6 months with order counts
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Revenue overview retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      monthlyRevenue:
                        type: array
                        items:
                          type: object
                          properties:
                            month:
                              type: string
                              example: "2024-01"
                            revenue:
                              type: number
                              example: 15000.00
                            orderCount:
                              type: integer
                              example: 120
                      totalRevenue:
                        type: number
                        example: 125000.50
                      totalOrders:
                        type: integer
                        example: 1250
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /admin/dashboard/recent-activity:
    get:
      summary: Get recent activity
      description: Retrieve recent orders, new customers, and reviews for the dashboard
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          description: Number of items to return
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: Recent activity retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      recentOrders:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                              example: "order_id"
                            orderNumber:
                              type: string
                              example: "TB000123"
                            customer:
                              type: object
                              properties:
                                name:
                                  type: string
                                  example: "John Doe"
                                email:
                                  type: string
                                  example: "john@example.com"
                            status:
                              type: string
                              example: "pending"
                            totalAmount:
                              type: number
                              example: 150.00
                            itemCount:
                              type: integer
                              example: 2
                            createdAt:
                              type: string
                              format: date-time
                      recentCustomers:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            name:
                              type: string
                            email:
                              type: string
                            joinedAt:
                              type: string
                              format: date-time
                      recentReviews:
                        type: array
                        items:
                          type: object
                          properties:
                            id:
                              type: string
                            user:
                              type: object
                              properties:
                                name:
                                  type: string
                            product:
                              type: object
                              properties:
                                name:
                                  type: string
                                brand:
                                  type: string
                            rating:
                              type: integer
                              minimum: 1
                              maximum: 5
                            comment:
                              type: string
                            createdAt:
                              type: string
                              format: date-time
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /admin/dashboard/order-statistics:
    get:
      summary: Get order statistics by status
      description: Retrieve order counts and total values grouped by order status
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Order statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      orderStatistics:
                        type: array
                        items:
                          type: object
                          properties:
                            status:
                              type: string
                              example: "completed"
                            count:
                              type: integer
                              example: 800
                            totalValue:
                              type: number
                              example: 80000.00
                      totalOrders:
                        type: integer
                        example: 1250
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /admin/dashboard/top-selling-products:
    get:
      summary: Get top selling products
      description: Retrieve the most popular products based on quantity sold. This is a public endpoint that doesn't require authentication.
      tags: [Admin Dashboard]
      parameters:
        - name: limit
          in: query
          description: Number of products to return
          required: false
          schema:
            type: integer
            default: 10
            minimum: 1
            maximum: 50
      responses:
        '200':
          description: Top selling products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      topSellingProducts:
                        type: array
                        items:
                          type: object
                          properties:
                            productId:
                              type: string
                            productName:
                              type: string
                              example: "Cotton T-Shirt"
                            brand:
                              type: string
                              example: "TrendBite"
                            image:
                              type: string
                              example: "image_url"
                            price:
                              type: number
                              example: 99.99
                            totalQuantity:
                              type: integer
                              example: 150
                            totalRevenue:
                              type: number
                              example: 15000.00
                            orderCount:
                              type: integer
                              example: 75
        '500':
          $ref: '#/components/responses/InternalServerError'

  /admin/dashboard/customer-analytics:
    get:
      summary: Get customer analytics
      description: Retrieve customer-related statistics and trends
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Customer analytics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      totalCustomers:
                        type: integer
                        example: 850
                      newCustomersThisMonth:
                        type: integer
                        example: 45
                      customersWithOrders:
                        type: integer
                        example: 650
                      averageOrdersPerCustomer:
                        type: number
                        example: 1.47
                      customerTrend:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: object
                              properties:
                                year:
                                  type: integer
                                  example: 2024
                                month:
                                  type: integer
                                  example: 1
                            count:
                              type: integer
                              example: 45
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /users/register:
    post:
      summary: Register a new user
      description: Create a new user account with customer role by default
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - firstName
                - lastName
                - email
                - password
              properties:
                firstName:
                  type: string
                  maxLength: 50
                  example: John
                  description: User's first name
                lastName:
                  type: string
                  maxLength: 50
                  example: Doe
                  description: User's last name
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                  description: User's email address (must be unique)
                password:
                  type: string
                  minLength: 6
                  example: password123
                  description: User's password (minimum 6 characters)
                phone:
                  type: string
                  example: "+1234567890"
                  description: User's phone number (optional)
                dateOfBirth:
                  type: string
                  format: date
                  example: "1990-01-01"
                  description: User's date of birth (optional)
                gender:
                  type: string
                  enum: [male, female, other, prefer-not-to-say]
                  default: prefer-not-to-say
                  example: male
                  description: User's gender (optional)
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User registered successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '400':
          description: Validation error or user already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/login:
    post:
      summary: Login user
      description: Authenticate user and return JWT token
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                  description: User's email address
                password:
                  type: string
                  example: password123
                  description: User's password
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Login successful
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
        '401':
          description: Invalid credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/forgot-password:
    post:
      summary: Request password reset link
      description: |
        Send a password reset link to the user's email address. The link will expire in 1 hour.
        For security reasons, the same success message is returned whether the email exists or not.
      tags: [Users]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
              properties:
                email:
                  type: string
                  format: email
                  example: john.doe@example.com
                  description: User's email address
      responses:
        '200':
          description: Password reset link sent successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password reset link has been sent to your email
        '400':
          description: Email is required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/reset-password/{token}:
    post:
      summary: Reset password with token
      description: |
        Reset the user's password using the token received in email. 
        Returns a new JWT token for automatic login after successful password reset.
      tags: [Users]
      parameters:
        - in: path
          name: token
          required: true
          schema:
            type: string
          description: Password reset token from email
          example: abc123def456ghi789jkl012mno345pqr678
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - password
              properties:
                password:
                  type: string
                  minLength: 6
                  example: newpassword123
                  description: New password (minimum 6 characters)
      responses:
        '200':
          description: Password reset successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password reset successful
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
                        example: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                        description: JWT token for automatic login
        '400':
          description: Invalid or expired reset token, or password validation error
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: false
                  message:
                    type: string
                    example: Invalid or expired reset token
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/profile:
    get:
      summary: Get current user profile
      description: Retrieve the authenticated user's profile information
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Profile retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Profile retrieved successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update user profile
      description: Update the authenticated user's profile information
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                firstName:
                  type: string
                  maxLength: 50
                  example: John
                  description: User's first name
                lastName:
                  type: string
                  maxLength: 50
                  example: Doe
                  description: User's last name
                phone:
                  type: string
                  example: "+1234567890"
                  description: User's phone number
                dateOfBirth:
                  type: string
                  format: date
                  example: "1990-01-01"
                  description: User's date of birth
                gender:
                  type: string
                  enum: [male, female, other, prefer-not-to-say]
                  example: male
                  description: User's gender
                address:
                  type: object
                  properties:
                    street:
                      type: string
                      example: "123 Main St"
                      description: Street address
                    city:
                      type: string
                      example: "New York"
                      description: City
                    state:
                      type: string
                      example: "NY"
                      description: State
                    zipCode:
                      type: string
                      example: "10001"
                      description: ZIP code
                    country:
                      type: string
                      example: "US"
                      description: Country
                preferences:
                  type: object
                  properties:
                    newsletter:
                      type: boolean
                      example: true
                      description: Newsletter subscription preference
                    notifications:
                      type: boolean
                      example: true
                      description: Notification preference
      responses:
        '200':
          description: Profile updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Profile updated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/upload-avatar:
    post:
      summary: Upload user avatar
      description: Upload a profile picture for the authenticated user
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                avatar:
                  type: string
                  format: binary
                  description: Image file (jpg, jpeg, png, gif, webp) - Max 5MB
      responses:
        '200':
          description: Avatar uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Avatar uploaded successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: No file uploaded or invalid file type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/avatar:
    delete:
      summary: Delete user avatar
      description: Remove the profile picture for the authenticated user
      tags: [Users]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Avatar deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Avatar deleted successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/change-password:
    put:
      summary: Change user password
      description: Change the password for the authenticated user
      tags: [Users]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentPassword
                - newPassword
              properties:
                currentPassword:
                  type: string
                  example: oldpassword123
                  description: Current password
                newPassword:
                  type: string
                  minLength: 6
                  example: newpassword123
                  description: New password (minimum 6 characters)
      responses:
        '200':
          description: Password changed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Password changed successfully
        '400':
          description: Validation error or incorrect current password
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users:
    get:
      summary: Get all users (Admin only)
      description: Retrieve a paginated list of all users with filtering options
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of users per page
        - in: query
          name: role
          schema:
            type: string
            enum: [customer, admin]
          description: Filter by user role
        - in: query
          name: search
          schema:
            type: string
          description: Search by name or email
        - in: query
          name: isActive
          schema:
            type: boolean
          description: Filter by active status
      responses:
        '200':
          description: Users retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Users retrieved successfully
                  data:
                    type: object
                    properties:
                      users:
                        type: array
                        items:
                          $ref: '#/components/schemas/User'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}:
    get:
      summary: Get user by ID (Admin only)
      description: Retrieve a specific user by their ID
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User retrieved successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete user (Admin only)
      description: Permanently delete a user account
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User deleted successfully
        '400':
          description: Cannot delete own account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}/role:
    put:
      summary: Update user role (Admin only)
      description: Change the role of a specific user
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - role
              properties:
                role:
                  type: string
                  enum: [customer, admin, deliveryperson]
                  example: admin
                  description: New user role
      responses:
        '200':
          description: User role updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User role updated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Invalid role
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}/deactivate:
    put:
      summary: Deactivate user (Admin only)
      description: Deactivate a user account (soft delete)
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User deactivated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User deactivated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '400':
          description: Cannot deactivate own account
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /users/{id}/activate:
    put:
      summary: Activate user (Admin only)
      description: Reactivate a previously deactivated user account
      tags: [Users]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: User ID
      responses:
        '200':
          description: User activated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User activated successfully
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: User not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products:
    get:
      summary: Get all products with filtering and pagination
      description: Retrieve products with advanced filtering, sorting, and pagination options
      tags: [Products]
      parameters:
        - in: query
          name: category
          schema:
            type: string
          description: Filter by category ID
        - in: query
          name: brand
          schema:
            type: string
          description: Filter by brand
        - in: query
          name: gender
          schema:
            type: string
            enum: [men, women, unisex]
          description: Filter by gender
        - in: query
          name: minPrice
          schema:
            type: number
          description: Minimum price filter
        - in: query
          name: maxPrice
          schema:
            type: number
          description: Maximum price filter
        - in: query
          name: size
          schema:
            type: string
          description: Filter by size
        - in: query
          name: color
          schema:
            type: string
          description: Filter by color
        - in: query
          name: skinTone
          schema:
            type: string
          description: Filter by suitable skin tone
        - in: query
          name: material
          schema:
            type: string
          description: Filter by material
        - in: query
          name: tags
          schema:
            type: string
          description: Filter by tags
        - in: query
          name: search
          schema:
            type: string
          description: Search query
        - in: query
          name: isFeatured
          schema:
            type: boolean
          description: Filter featured products
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, name, price, totalSales, averageRating]
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 12
          description: Products per page
      responses:
        '200':
          description: Products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Products retrieved successfully
                  data:
                    type: object
                    properties:
                      products:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new product
      description: Create a new product with variants, pricing, and inventory information
      tags: [Products]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
                - description
                - brand
                - category
                - gender
                - variants
              properties:
                name:
                  type: string
                  maxLength: 200
                  example: "Premium Cotton T-Shirt"
                description:
                  type: string
                  maxLength: 2000
                  example: "High-quality cotton t-shirt perfect for everyday wear"
                shortDescription:
                  type: string
                  maxLength: 300
                  example: "Comfortable cotton t-shirt"
                brand:
                  type: string
                  maxLength: 100
                  example: "TrendBite"
                category:
                  type: string
                  example: "64f1a2b3c4d5e6f7g8h9i0j1"
                gender:
                  type: string
                  enum: [men, women, unisex]
                  example: "unisex"
                material:
                  type: string
                  maxLength: 200
                  example: "100% Cotton"
                tags:
                  type: array
                  items:
                    type: string
                  example: ["casual", "cotton", "comfortable"]
                suitableSkinTone:
                  type: array
                  items:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "Fair"
                      hex:
                        type: string
                        example: "#FFE0BD"
                  example: [{"name": "Fair", "hex": "#FFE0BD"}, {"name": "Medium", "hex": "#C68642"}]
                variants:
                  type: array
                  items:
                    type: object
                    required:
                      - size
                      - color
                      - price
                      - stockQuantity
                    properties:
                      size:
                        type: string
                        example: "M"
                      color:
                        type: object
                        properties:
                          name:
                            type: string
                            example: "Red"
                          hex:
                            type: string
                            example: "#FF0000"
                      sku:
                        type: string
                        example: "TSHIRT-M-RED-001"
                      stockQuantity:
                        type: number
                        minimum: 0
                        example: 50
                      price:
                        type: object
                        properties:
                          regular:
                            type: number
                            minimum: 0
                            example: 29.99
                          sale:
                            type: number
                            minimum: 0
                            example: 24.99
                currency:
                  type: string
                  enum: [USD, LKR, EUR, GBP]
                  default: USD
                status:
                  type: string
                  enum: [draft, published, archived]
                  default: draft
                isFeatured:
                  type: boolean
                  default: false
                discountPercentage:
                  type: number
                  minimum: 0
                  maximum: 100
                  default: 0
                bulkPricing:
                  type: array
                  items:
                    type: object
                    properties:
                      minQuantity:
                        type: number
                        minimum: 1
                      maxQuantity:
                        type: number
                        minimum: 1
                      discountType:
                        type: string
                        enum: [percentage, fixed]
                      discountValue:
                        type: number
                        minimum: 0
                lowStockThreshold:
                  type: number
                  minimum: 0
                  default: 10
      responses:
        '201':
          description: Product created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product created successfully
                  data:
                    type: object
                    properties:
                      product:
                        $ref: '#/components/schemas/Product'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{id}:
    get:
      summary: Get single product by ID
      description: Retrieve a specific product with related products
      tags: [Products]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Product ID
      responses:
        '200':
          description: Product retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product retrieved successfully
                  data:
                    type: object
                    properties:
                      product:
                        $ref: '#/components/schemas/Product'
                      relatedProducts:
                        type: array
                        items:
                          $ref: '#/components/schemas/Product'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update product
      description: Update an existing product
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Product ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                  maxLength: 200
                description:
                  type: string
                  maxLength: 2000
                shortDescription:
                  type: string
                  maxLength: 300
                brand:
                  type: string
                  maxLength: 100
                category:
                  type: string
                gender:
                  type: string
                  enum: [men, women, unisex]
                material:
                  type: string
                  maxLength: 200
                tags:
                  type: array
                  items:
                    type: string
                variants:
                  type: array
                  items:
                    type: object
                status:
                  type: string
                  enum: [draft, published, archived]
                isActive:
                  type: boolean
                isFeatured:
                  type: boolean
                discountPercentage:
                  type: number
                  minimum: 0
                  maximum: 100
                bulkPricing:
                  type: array
                  items:
                    type: object
                lowStockThreshold:
                  type: number
                  minimum: 0
      responses:
        '200':
          description: Product updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product updated successfully
                  data:
                    type: object
                    properties:
                      product:
                        $ref: '#/components/schemas/Product'
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete product
      description: Permanently delete a product and its images
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Product ID
      responses:
        '200':
          description: Product deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{id}/upload-images:
    post:
      summary: Upload product images
      description: Upload multiple images for a specific product (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Product ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                images:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: Image files (max 5 files, 5MB each)
                isMain:
                  type: string
                  description: Set first image as main image
                alt:
                  type: string
                  description: Alt text for images
      responses:
        '200':
          description: Images uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product images uploaded successfully
                  data:
                    type: object
                    properties:
                      product:
                        type: object
                        properties:
                          _id:
                            type: string
                          name:
                            type: string
                          images:
                            type: array
                            items:
                              type: object
                              properties:
                                _id:
                                  type: string
                                public_id:
                                  type: string
                                url:
                                  type: string
                                alt:
                                  type: string
                                order:
                                  type: number
                                isMain:
                                  type: boolean
        '400':
          description: No image files uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /products/{id}/images/{imageId}:
    delete:
      summary: Delete product image
      description: Delete a specific image from a product (Admin only)
      tags: [Products]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Product ID
        - in: path
          name: imageId
          required: true
          schema:
            type: string
          description: Image ID
      responses:
        '200':
          description: Image deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product image deleted successfully
                  data:
                    type: object
                    properties:
                      product:
                        type: object
                        properties:
                          _id:
                            type: string
                          name:
                            type: string
                          images:
                            type: array
                            items:
                              type: object
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product or image not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories:
    get:
      summary: Get all categories
      description: Retrieve all categories with optional filtering
      tags: [Categories]
      parameters:
        - in: query
          name: includeInactive
          schema:
            type: boolean
            default: false
          description: Include inactive categories
      responses:
        '200':
          description: Categories retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Categories retrieved successfully
                  data:
                    type: object
                    properties:
                      categories:
                        type: array
                        items:
                          $ref: '#/components/schemas/Category'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create new category
      description: Create a new category with optional parent category
      tags: [Categories]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  maxLength: 100
                  example: "T-Shirts"
                description:
                  type: string
                  maxLength: 500
                  example: "Comfortable and stylish t-shirts"
                parent:
                  type: string
                  example: "64f1a2b3c4d5e6f7g8h9i0j1"
                  description: Parent category ID (optional)
                image:
                  type: object
                  properties:
                    public_id:
                      type: string
                    url:
                      type: string
                isActive:
                  type: boolean
                  default: true
                sortOrder:
                  type: number
                  default: 0
                seoTitle:
                  type: string
                  maxLength: 60
                seoDescription:
                  type: string
                  maxLength: 160
                seoKeywords:
                  type: array
                  items:
                    type: string
      responses:
        '201':
          description: Category created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Category created successfully
                  data:
                    type: object
                    properties:
                      category:
                        $ref: '#/components/schemas/Category'
        '400':
          description: Validation error or parent category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories/{id}:
    get:
      summary: Get single category
      description: Retrieve a specific category with breadcrumb navigation
      tags: [Categories]
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Category ID
      responses:
        '200':
          description: Category retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Category retrieved successfully
                  data:
                    type: object
                    properties:
                      category:
                        $ref: '#/components/schemas/Category'
                      breadcrumb:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                            name:
                              type: string
                            slug:
                              type: string
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /categories/{id}/upload-image:
    post:
      summary: Upload category image
      description: Upload an image for a specific category (Admin only)
      tags: [Categories]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
          description: Category ID
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                image:
                  type: string
                  format: binary
                  description: Category image file (max 5MB)
      responses:
        '200':
          description: Category image uploaded successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Category image uploaded successfully
                  data:
                    type: object
                    properties:
                      category:
                        type: object
                        properties:
                          _id:
                            type: string
                          name:
                            type: string
                          image:
                            type: object
                            properties:
                              public_id:
                                type: string
                              url:
                                type: string
        '400':
          description: No image file uploaded
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Category not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders:
    post:
      summary: Create a new order
      description: Create a new order with items, addresses, and payment information
      tags: [Orders]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - items
                - deliveryAddress
                - billingAddress
              properties:
                items:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - productId
                      - variant
                      - quantity
                    properties:
                      productId:
                        type: string
                        example: "64a1b2c3d4e5f6789012345"
                        description: Product ID
                      variant:
                        type: object
                        required:
                          - size
                          - color
                          - sku
                        properties:
                          size:
                            type: string
                            example: "M"
                            description: Product size
                          color:
                            type: object
                            required:
                              - name
                            properties:
                              name:
                                type: string
                                example: "Blue"
                                description: Color name
                              hex:
                                type: string
                                example: "#0000FF"
                                description: Color hex code
                          sku:
                            type: string
                            example: "TB-SHIRT-M-BLUE-001"
                            description: Product SKU
                      quantity:
                        type: integer
                        minimum: 1
                        example: 2
                        description: Quantity ordered
                deliveryAddress:
                  type: object
                  required:
                    - street
                    - city
                    - state
                    - zipCode
                    - phone
                  properties:
                    street:
                      type: string
                      example: "123 Main Street"
                      description: Street address
                    city:
                      type: string
                      example: "Colombo"
                      description: City
                    state:
                      type: string
                      example: "Western Province"
                      description: State/Province
                    zipCode:
                      type: string
                      example: "00100"
                      description: ZIP/Postal code
                    country:
                      type: string
                      example: "Sri Lanka"
                      description: Country
                    phone:
                      type: string
                      example: "+94771234567"
                      description: Contact phone number
                billingAddress:
                  type: object
                  required:
                    - street
                    - city
                    - state
                    - zipCode
                  properties:
                    street:
                      type: string
                      example: "123 Main Street"
                      description: Street address
                    city:
                      type: string
                      example: "Colombo"
                      description: City
                    state:
                      type: string
                      example: "Western Province"
                      description: State/Province
                    zipCode:
                      type: string
                      example: "00100"
                      description: ZIP/Postal code
                    country:
                      type: string
                      example: "Sri Lanka"
                      description: Country
                paymentMethod:
                  type: string
                  enum: [cash_on_delivery, credit_card, debit_card, bank_transfer, digital_wallet]
                  example: "cash_on_delivery"
                  description: Payment method
                shippingMethod:
                  type: string
                  enum: [standard, express]
                  default: standard
                  example: "standard"
                  description: |
                    Shipping method (optional):
                    - `standard`: 3 working days delivery (Cost: 400 LKR)
                    - `express`: Within 1 day delivery (Cost: 1000 LKR)
                    Default is `standard` if not specified
                discountCode:
                  type: string
                  example: "WELCOME10"
                  description: Discount code (optional)
                notes:
                  type: string
                  maxLength: 500
                  example: "Please deliver after 6 PM"
                  description: Order notes (optional)
      responses:
        '201':
          description: Order created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order created successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Validation error or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    get:
      summary: Get all orders (Admin only)
      description: Retrieve all orders with filtering and pagination options
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, confirmed, shipped, assigned, out_for_delivery, delivered, completed, cancelled]
          description: Filter by order status
        - in: query
          name: paymentStatus
          schema:
            type: string
            enum: [pending, paid, failed, refunded, partially_refunded]
          description: Filter by payment status
        - in: query
          name: customer
          schema:
            type: string
          description: Filter by customer ID
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Start date filter (ISO format)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: End date filter (ISO format)
        - in: query
          name: search
          schema:
            type: string
          description: Search by order number, customer email, or phone
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, updatedAt, totalAmount, status]
            default: createdAt
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Orders per page
      responses:
        '200':
          description: Orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Orders retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  pagination:
                    $ref: '#/components/schemas/OrderPagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/my-orders:
    get:
      summary: Get customer orders
      description: Retrieve orders for the authenticated customer
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [pending, confirmed, shipped, assigned, out_for_delivery, delivered, completed, cancelled]
          description: Filter by order status
        - in: query
          name: paymentStatus
          schema:
            type: string
            enum: [pending, paid, failed, refunded, partially_refunded]
          description: Filter by payment status
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Start date filter (ISO format)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: End date filter (ISO format)
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, updatedAt, totalAmount, status]
            default: createdAt
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Orders per page
      responses:
        '200':
          description: Customer orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Customer orders retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  pagination:
                    $ref: '#/components/schemas/OrderPagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/validate-discount:
    post:
      summary: Validate discount code
      description: Validate a discount code and calculate discount amount. Note: Each user can only use a discount code once due to per-user tracking.
      tags: [Orders]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
                - orderAmount
              properties:
                code:
                  type: string
                  example: "WELCOME10"
                  description: Discount code to validate
                orderAmount:
                  type: number
                  minimum: 0
                  example: 2000
                  description: Order amount for discount calculation
      responses:
        '200':
          description: Discount code is valid
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code is valid"
                  data:
                    type: object
                    properties:
                      code:
                        type: string
                        example: "WELCOME10"
                      name:
                        type: string
                        example: "Welcome Discount"
                      type:
                        type: string
                        enum: [percentage, fixed]
                        example: "fixed"
                      value:
                        type: number
                        example: 200
                      discountAmount:
                        type: number
                        example: 200
                      displayValue:
                        type: string
                        example: "LKR 200"
        '400':
          description: Invalid or expired discount code
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/stats/overview:
    get:
      summary: Get order statistics (Admin only)
      description: Retrieve order statistics with optional date filtering
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Start date for statistics (ISO format)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: End date for statistics (ISO format)
      responses:
        '200':
          description: Order statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order statistics retrieved successfully"
                  data:
                    type: object
                    properties:
                      totalOrders:
                        type: integer
                        example: 150
                        description: Total number of orders
                      totalRevenue:
                        type: number
                        example: 450000
                        description: Total revenue
                      averageOrderValue:
                        type: number
                        example: 3000
                        description: Average order value
                      pendingOrders:
                        type: integer
                        example: 5
                        description: Number of pending orders
                      completedOrders:
                        type: integer
                        example: 120
                        description: Number of completed orders
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}:
    get:
      summary: Get order by ID
      description: Retrieve a specific order by ID. Customers can only view their own orders.
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      responses:
        '200':
          description: Order retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order retrieved successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied - can only view own orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update order (Admin or Order Owner)
      description: Update order fields. Admins can update any field, customers can only update their own orders.
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                status:
                  type: string
                  enum: [pending, confirmed, shipped, assigned, out_for_delivery, delivered, completed, cancelled]
                  example: "shipped"
                  description: New order status
                notes:
                  type: string
                  maxLength: 500
                  example: "Order is being prepared for shipping"
                  description: Order notes
                deliveryAddress:
                  type: object
                  description: Updated delivery address
                  properties:
                    street:
                      type: string
                    city:
                      type: string
                    state:
                      type: string
                    zipCode:
                      type: string
                    country:
                      type: string
                    phone:
                      type: string
                billingAddress:
                  type: object
                  description: Updated billing address
                  properties:
                    street:
                      type: string
                    city:
                      type: string
                    state:
                      type: string
                    zipCode:
                      type: string
                    country:
                      type: string
      responses:
        '200':
          description: Order updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order updated successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Invalid order status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/delivery-address:
    put:
      summary: Update delivery address
      description: Update the delivery address for an order (customers only, before processing)
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deliveryAddress
              properties:
                deliveryAddress:
                  type: object
                  required:
                    - street
                    - city
                    - state
                    - zipCode
                    - phone
                  properties:
                    street:
                      type: string
                      example: "456 New Street"
                      description: Street address
                    city:
                      type: string
                      example: "Kandy"
                      description: City
                    state:
                      type: string
                      example: "Central Province"
                      description: State/Province
                    zipCode:
                      type: string
                      example: "20000"
                      description: ZIP/Postal code
                    country:
                      type: string
                      example: "Sri Lanka"
                      description: Country
                    phone:
                      type: string
                      example: "+94771234568"
                      description: Contact phone number
      responses:
        '200':
          description: Delivery address updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery address updated successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Cannot update address - order is already being processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied - can only update own orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/cancel:
    put:
      summary: Cancel order
      description: Cancel an order (customers only, before processing)
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reason:
                  type: string
                  maxLength: 500
                  example: "Changed my mind"
                  description: Cancellation reason (optional)
      responses:
        '200':
          description: Order cancelled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order cancelled successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Cannot cancel order - order is already being processed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied - can only cancel own orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/shipping:
    put:
      summary: Update shipping details (Admin only)
      description: |
        Update shipping information for an order. When shipping details are updated, the order status will automatically change to `shipped` if the current status is `pending` or `confirmed`. The status history will be updated with the tracking and partner information.
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                trackingNumber:
                  type: string
                  example: "TB123456789"
                  description: Tracking number (optional)
                deliveryPartner:
                  type: string
                  example: "Express Delivery"
                  description: Delivery partner name (optional)
                estimatedDeliveryDate:
                  type: string
                  format: date-time
                  example: "2024-01-20T18:00:00.000Z"
                  description: Estimated delivery date (optional)
      responses:
        '200':
          description: Shipping details updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Shipping details updated successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/payment:
    put:
      summary: Update payment status (Admin only)
      description: Update payment information for an order
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - paymentStatus
              properties:
                paymentStatus:
                  type: string
                  enum: [pending, paid, failed, refunded, partially_refunded]
                  example: "paid"
                  description: Payment status
                transactionId:
                  type: string
                  example: "TXN123456789"
                  description: Transaction ID (optional)
      responses:
        '200':
          description: Payment status updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment status updated successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '400':
          description: Invalid payment status
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/{orderId}/rate-delivery:
    post:
      summary: Rate delivery person (Customer only)
      description: Allows customers to rate and provide feedback on delivery service after order delivery
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - rating
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                  description: Rating from 1 to 5 stars
                feedback:
                  type: string
                  maxLength: 500
                  example: "Excellent service! Very professional and on time."
                  description: Optional feedback text
      responses:
        '200':
          description: Delivery rating submitted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery rating submitted successfully"
                  data:
                    type: object
                    properties:
                      orderId:
                        type: string
                        example: "654321abcdef123456789012"
                      orderNumber:
                        type: string
                        example: "TB000123"
                      deliveryRating:
                        $ref: '#/components/schemas/DeliveryRating'
                      deliveryPerson:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "123456abcdef123456789012"
                          name:
                            type: string
                            example: "John Doe"
                          averageRating:
                            type: number
                            example: 4.8
                          totalRatings:
                            type: integer
                            example: 157
        '400':
          description: Bad request - Invalid rating or order cannot be rated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Access denied - Can only rate own orders
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/delivery-ratings/{deliveryPersonId}:
    get:
      summary: Get delivery person ratings (Admin or Delivery Person)
      description: Retrieve all ratings and feedback for a specific delivery person with rating distribution. Delivery persons can only view their own ratings, admins can view any delivery person's ratings.
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: deliveryPersonId
          required: true
          schema:
            type: string
          description: Delivery person ID
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number for pagination
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
          description: Number of ratings per page
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [ratedAt, rating]
            default: ratedAt
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
      responses:
        '200':
          description: Delivery person ratings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery person ratings retrieved successfully"
                  data:
                    type: object
                    properties:
                      deliveryPerson:
                        type: object
                        properties:
                          id:
                            type: string
                            example: "123456abcdef123456789012"
                          name:
                            type: string
                            example: "John Doe"
                          averageRating:
                            type: number
                            example: 4.8
                          totalRatings:
                            type: integer
                            example: 157
                          totalDeliveries:
                            type: integer
                            example: 200
                      ratingDistribution:
                        $ref: '#/components/schemas/RatingDistribution'
                      ratings:
                        type: array
                        items:
                          $ref: '#/components/schemas/DeliveryRatingDetail'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid delivery person
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Delivery person not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /orders/delivery-persons/ratings:
    get:
      summary: Get all delivery persons with ratings (Admin only)
      description: Retrieve all delivery persons with their rating statistics and performance metrics
      tags: [Orders]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [averageRating, totalRatings, totalDeliveries]
            default: averageRating
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
      responses:
        '200':
          description: Delivery persons with ratings retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery persons with ratings retrieved successfully"
                  data:
                    type: object
                    properties:
                      deliveryPersons:
                        type: array
                        items:
                          $ref: '#/components/schemas/DeliveryPersonWithRatings'
                      total:
                        type: integer
                        example: 5
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /discounts:
    get:
      summary: Get all discount codes (Admin only)
      description: Retrieve all discount codes with filtering and pagination
      tags: [Discounts]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: isActive
          schema:
            type: boolean
          description: Filter by active status
        - in: query
          name: isPublic
          schema:
            type: boolean
          description: Filter by public status
        - in: query
          name: type
          schema:
            type: string
            enum: [percentage, fixed]
          description: Filter by discount type
        - in: query
          name: search
          schema:
            type: string
          description: Search by code, name, or description
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, updatedAt, code, name, usedCount]
            default: createdAt
          description: Sort field
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
            default: desc
          description: Sort order
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
            default: 1
          description: Page number
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          description: Discounts per page
      responses:
        '200':
          description: Discount codes retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount codes retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Discount'
                  pagination:
                    $ref: '#/components/schemas/DiscountPagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create discount code (Admin only)
      description: Create a new discount code with validation rules
      tags: [Discounts]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - code
                - name
                - type
                - value
                - validFrom
                - validUntil
              properties:
                code:
                  type: string
                  minLength: 3
                  maxLength: 20
                  example: "SUMMER20"
                  description: Discount code
                name:
                  type: string
                  maxLength: 100
                  example: "Summer Sale"
                  description: Discount name
                description:
                  type: string
                  maxLength: 500
                  example: "20% off on summer collection"
                  description: Discount description
                type:
                  type: string
                  enum: [percentage, fixed]
                  example: "percentage"
                  description: Discount type
                value:
                  type: number
                  minimum: 0
                  example: 20
                  description: Discount value
                minimumOrderAmount:
                  type: number
                  minimum: 0
                  example: 2000
                  description: Minimum order amount required
                maximumDiscountAmount:
                  type: number
                  minimum: 0
                  example: 1000
                  description: Maximum discount amount
                usageLimit:
                  type: integer
                  minimum: 1
                  example: 50
                  description: Maximum usage limit
                validFrom:
                  type: string
                  format: date-time
                  example: "2024-06-01T00:00:00.000Z"
                  description: Valid from date
                validUntil:
                  type: string
                  format: date-time
                  example: "2024-08-31T23:59:59.000Z"
                  description: Valid until date
                applicableProducts:
                  type: array
                  items:
                    type: string
                  example: ["64a1b2c3d4e5f6789012345"]
                  description: Applicable product IDs
                applicableCategories:
                  type: array
                  items:
                    type: string
                  example: ["64a1b2c3d4e5f678901234a"]
                  description: Applicable category IDs
                applicableUsers:
                  type: array
                  items:
                    type: string
                  example: []
                  description: Applicable user IDs (empty for all users)
                isPublic:
                  type: boolean
                  default: true
                  example: true
                  description: Whether discount is public
      responses:
        '201':
          description: Discount code created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code created successfully"
                  data:
                    $ref: '#/components/schemas/Discount'
        '400':
          description: Validation error or discount code already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /discounts/active:
    get:
      summary: Get active discount codes
      description: Retrieve all active discount codes available to the user (public endpoint). If a user is authenticated, discounts they have already used will be filtered out.
      tags: [Discounts]
      responses:
        '200':
          description: Active discount codes retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Active discount codes retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Discount'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /discounts/stats:
    get:
      summary: Get discount statistics (Admin only)
      description: Retrieve discount code usage statistics. Note: With per-user tracking enabled, each user can only use a discount once, so totalUsage represents unique users who have used discounts.
      tags: [Discounts]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Discount statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount statistics retrieved successfully"
                  data:
                    type: object
                    properties:
                      totalDiscounts:
                        type: integer
                        example: 10
                        description: Total number of discount codes
                      activeDiscounts:
                        type: integer
                        example: 8
                        description: Number of active discount codes
                      publicDiscounts:
                        type: integer
                        example: 6
                        description: Number of public discount codes
                      totalUsage:
                        type: integer
                        example: 150
                        description: Total usage count across all discounts
                      percentageDiscounts:
                        type: integer
                        example: 5
                        description: Number of percentage-based discounts
                      fixedDiscounts:
                        type: integer
                        example: 5
                        description: Number of fixed-amount discounts
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /discounts/{discountId}:
    get:
      summary: Get discount by ID (Admin only)
      description: Retrieve a specific discount code by ID
      tags: [Discounts]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: discountId
          required: true
          schema:
            type: string
          description: Discount ID
      responses:
        '200':
          description: Discount code retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code retrieved successfully"
                  data:
                    $ref: '#/components/schemas/Discount'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Discount code not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update discount code (Admin only)
      description: Update an existing discount code
      tags: [Discounts]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: discountId
          required: true
          schema:
            type: string
          description: Discount ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                  minLength: 3
                  maxLength: 20
                  example: "SUMMER25"
                  description: Discount code
                name:
                  type: string
                  maxLength: 100
                  example: "Summer Sale 25%"
                  description: Discount name
                description:
                  type: string
                  maxLength: 500
                  example: "25% off on summer collection"
                  description: Discount description
                type:
                  type: string
                  enum: [percentage, fixed]
                  example: "percentage"
                  description: Discount type
                value:
                  type: number
                  minimum: 0
                  example: 25
                  description: Discount value
                minimumOrderAmount:
                  type: number
                  minimum: 0
                  example: 2000
                  description: Minimum order amount required
                maximumDiscountAmount:
                  type: number
                  minimum: 0
                  example: 1000
                  description: Maximum discount amount
                usageLimit:
                  type: integer
                  minimum: 1
                  example: 50
                  description: Maximum usage limit
                validFrom:
                  type: string
                  format: date-time
                  example: "2024-06-01T00:00:00.000Z"
                  description: Valid from date
                validUntil:
                  type: string
                  format: date-time
                  example: "2024-08-31T23:59:59.000Z"
                  description: Valid until date
                applicableProducts:
                  type: array
                  items:
                    type: string
                  example: ["64a1b2c3d4e5f6789012345"]
                  description: Applicable product IDs
                applicableCategories:
                  type: array
                  items:
                    type: string
                  example: ["64a1b2c3d4e5f678901234a"]
                  description: Applicable category IDs
                applicableUsers:
                  type: array
                  items:
                    type: string
                  example: []
                  description: Applicable user IDs
                isPublic:
                  type: boolean
                  example: true
                  description: Whether discount is public
                isActive:
                  type: boolean
                  example: true
                  description: Whether discount is active
      responses:
        '200':
          description: Discount code updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code updated successfully"
                  data:
                    $ref: '#/components/schemas/Discount'
        '400':
          description: Validation error or discount code already exists
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Discount code not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete discount code (Admin only)
      description: Permanently delete a discount code
      tags: [Discounts]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: discountId
          required: true
          schema:
            type: string
          description: Discount ID
      responses:
        '200':
          description: Discount code deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code deleted successfully"
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Discount code not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /discounts/{discountId}/toggle-status:
    patch:
      summary: Toggle discount status (Admin only)
      description: Toggle the active status of a discount code
      tags: [Discounts]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: discountId
          required: true
          schema:
            type: string
          description: Discount ID
      responses:
        '200':
          description: Discount status toggled successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Discount code activated successfully"
                  data:
                    $ref: '#/components/schemas/Discount'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Discount code not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Review Endpoints
  /reviews:
    get:
      summary: Get all reviews with filters
      description: Retrieve all reviews with optional filtering and pagination
      tags: [Reviews]
      parameters:
        - name: product
          in: query
          description: Filter by product ID
          schema:
            type: string
        - name: user
          in: query
          description: Filter by user ID
          schema:
            type: string
        - name: status
          in: query
          description: Filter by review status
          schema:
            type: string
            enum: [pending, approved, rejected]
        - name: rating
          in: query
          description: Filter by rating (1-5)
          schema:
            type: integer
            minimum: 1
            maximum: 5
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of reviews per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [createdAt, rating, updatedAt]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Reviews retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Reviews retrieved successfully
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Review'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    post:
      summary: Create a new review
      description: Submit a new product review (requires authentication and purchase verification)
      tags: [Reviews]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - productId
                - rating
                - title
                - description
              properties:
                productId:
                  type: string
                  example: 507f1f77bcf86cd799439011
                  description: ID of the product being reviewed
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 5
                  description: Rating from 1 to 5 stars
                title:
                  type: string
                  maxLength: 100
                  example: Excellent product!
                  description: Review title
                description:
                  type: string
                  maxLength: 1000
                  example: This product exceeded my expectations. Great quality and fast delivery.
                  description: Detailed review description
      responses:
        '201':
          description: Review created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review submitted successfully and is pending approval
                  data:
                    $ref: '#/components/schemas/Review'
        '400':
          description: Bad request or validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/product/{productId}:
    get:
      summary: Get reviews for a specific product
      description: Retrieve all approved reviews for a specific product with statistics
      tags: [Reviews]
      parameters:
        - name: productId
          in: path
          required: true
          description: Product ID
          schema:
            type: string
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of reviews per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [createdAt, rating, updatedAt]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Product reviews retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Product reviews retrieved successfully
                  data:
                    type: object
                    properties:
                      reviews:
                        type: array
                        items:
                          $ref: '#/components/schemas/Review'
                      stats:
                        $ref: '#/components/schemas/ReviewStats'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '404':
          description: Product not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/{id}:
    get:
      summary: Get a single review by ID
      description: Retrieve a specific review by its ID
      tags: [Reviews]
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      responses:
        '200':
          description: Review retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review retrieved successfully
                  data:
                    $ref: '#/components/schemas/Review'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    put:
      summary: Update a review
      description: Update an existing review (only by the review author)
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                rating:
                  type: integer
                  minimum: 1
                  maximum: 5
                  example: 4
                  description: Updated rating from 1 to 5 stars
                title:
                  type: string
                  maxLength: 100
                  example: Good product with minor issues
                  description: Updated review title
                description:
                  type: string
                  maxLength: 1000
                  example: Updated review description with more details.
                  description: Updated review description
      responses:
        '200':
          description: Review updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review updated successfully
                  data:
                    $ref: '#/components/schemas/Review'
        '400':
          description: Bad request or cannot edit approved reviews
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Not authorized to update this review
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

    delete:
      summary: Delete a review
      description: Delete a review (soft delete - only by the review author or admin)
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      responses:
        '200':
          description: Review deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review deleted successfully
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Not authorized to delete this review
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/user/my-reviews:
    get:
      summary: Get current user's reviews
      description: Retrieve all reviews created by the authenticated user
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of reviews per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 10
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [createdAt, rating, updatedAt]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: User reviews retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: User reviews retrieved successfully
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Review'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/admin/pending:
    get:
      summary: Get pending reviews for moderation (Admin only)
      description: Retrieve all reviews pending approval for admin moderation
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number for pagination
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: limit
          in: query
          description: Number of reviews per page
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: sortBy
          in: query
          description: Sort field
          schema:
            type: string
            enum: [createdAt, rating, updatedAt]
            default: createdAt
        - name: sortOrder
          in: query
          description: Sort order
          schema:
            type: string
            enum: [asc, desc]
            default: desc
      responses:
        '200':
          description: Pending reviews retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Pending reviews retrieved successfully
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Review'
                  pagination:
                    $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/{id}/approve:
    patch:
      summary: Approve a review (Admin only)
      description: Approve a pending review and update product rating
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      responses:
        '200':
          description: Review approved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review approved successfully
                  data:
                    $ref: '#/components/schemas/Review'
        '400':
          description: Review is already approved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/{id}/reject:
    patch:
      summary: Reject a review (Admin only)
      description: Reject a pending review
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      responses:
        '200':
          description: Review rejected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Review rejected successfully
                  data:
                    $ref: '#/components/schemas/Review'
        '400':
          description: Review is already rejected
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /reviews/{id}/reply:
    post:
      summary: Add admin reply to a review
      description: Add an admin reply to a review
      tags: [Reviews]
      security:
        - bearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Review ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - message
              properties:
                message:
                  type: string
                  maxLength: 500
                  example: Thank you for your feedback. We appreciate your review!
                  description: Admin reply message
      responses:
        '200':
          description: Admin reply added successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Admin reply added successfully
                  data:
                    $ref: '#/components/schemas/Review'
        '400':
          description: Bad request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Admin access required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Review not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart:
    get:
      summary: Get user's cart
      description: Retrieve the authenticated user's shopping cart with all items
      tags: [Cart]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Cart retrieved successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
                      invalidItems:
                        type: array
                        description: Items that were removed due to unavailability
                        items:
                          type: object
                          properties:
                            itemId:
                              type: string
                              example: 507f1f77bcf86cd799439011
                            reason:
                              type: string
                              example: Product out of stock
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Clear entire cart
      description: Remove all items from the user's cart
      tags: [Cart]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart cleared successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Cart cleared successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/items:
    post:
      summary: Add item to cart
      description: Add a product variant to the user's cart
      tags: [Cart]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddToCartRequest'
      responses:
        '200':
          description: Item added to cart successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Item added to cart successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '400':
          description: Bad request - Invalid input or business rule violation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product not found or not available
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/items/{itemId}:
    put:
      summary: Update item quantity in cart
      description: Update the quantity of a specific item in the cart
      tags: [Cart]
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          description: Cart item ID
          schema:
            type: string
            example: 507f1f77bcf86cd799439011
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateQuantityRequest'
      responses:
        '200':
          description: Item quantity updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Item quantity updated successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '400':
          description: Bad request - Invalid input or business rule violation
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Item not found in cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    delete:
      summary: Remove item from cart
      description: Remove a specific item from the cart
      tags: [Cart]
      security:
        - bearerAuth: []
      parameters:
        - name: itemId
          in: path
          required: true
          description: Cart item ID
          schema:
            type: string
            example: 507f1f77bcf86cd799439011
      responses:
        '200':
          description: Item removed from cart successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Item removed from cart successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '400':
          description: Bad request - Invalid item ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Item not found in cart
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/apply-discount:
    post:
      summary: Apply discount code to cart
      description: Apply a discount code to the user's cart
      tags: [Cart]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ApplyDiscountRequest'
      responses:
        '200':
          description: Discount applied successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Discount applied successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '400':
          description: Bad request - Invalid discount code or cart is empty
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/discount:
    delete:
      summary: Remove discount from cart
      description: Remove the applied discount from the cart
      tags: [Cart]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Discount removed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Discount removed successfully
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/summary:
    get:
      summary: Get cart summary for checkout
      description: Get a summary of the cart contents for checkout process
      tags: [Cart]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart summary retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Cart summary retrieved successfully
                  data:
                    type: object
                    properties:
                      summary:
                        $ref: '#/components/schemas/CartSummary'
        '400':
          description: Bad request - Cart is empty
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /cart/validate:
    post:
      summary: Validate cart items
      description: Validate all items in the cart and remove invalid ones
      tags: [Cart]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Cart validation completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: Cart validation completed
                  data:
                    type: object
                    properties:
                      cart:
                        $ref: '#/components/schemas/Cart'
                      invalidItems:
                        type: array
                        items:
                          type: object
                          properties:
                            itemId:
                              type: string
                              example: 507f1f77bcf86cd799439011
                            reason:
                              type: string
                              example: Product out of stock
                      isValid:
                        type: boolean
                        example: true
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Delivery Management Endpoints
  /delivery/orders/{orderId}/assign:
    post:
      summary: Assign delivery person to order
      description: Assign a delivery person to a confirmed order (Admin only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deliveryPersonId
              properties:
                deliveryPersonId:
                  type: string
                  description: ID of the delivery person to assign
                  example: "60f7b3b3b3b3b3b3b3b3b3b3"
      responses:
        '200':
          description: Delivery person assigned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Bad request - Invalid data or order not confirmed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order or delivery person not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/delivery-persons:
    get:
      summary: Get all delivery persons
      description: Retrieve a list of all delivery persons with their statistics (Admin only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: isActive
          schema:
            type: boolean
          description: Filter by active status
        - in: query
          name: search
          schema:
            type: string
          description: Search by name, email, or phone
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [createdAt, firstName, lastName, email]
          description: Sort field
          default: createdAt
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
          default: desc
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number
          default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Items per page
          default: 20
      responses:
        '200':
          description: Delivery persons retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery persons retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/DeliveryPersonWithStats'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '403':
          description: Forbidden - Admin role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/orders/{orderId}/reassign:
    put:
      summary: Reassign order to different delivery person
      description: Reassign an order to a different delivery person (Admin only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - deliveryPersonId
              properties:
                deliveryPersonId:
                  type: string
                  description: ID of the new delivery person
                  example: "60f7b3b3b3b3b3b3b3b3b3b3"
      responses:
        '200':
          description: Order reassigned successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Bad request - Invalid data or order not assigned
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order or delivery person not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/stats:
    get:
      summary: Get delivery statistics
      description: Retrieve overall delivery statistics and performance metrics (Admin only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Start date for statistics (YYYY-MM-DD)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: End date for statistics (YYYY-MM-DD)
      responses:
        '200':
          description: Delivery statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery statistics retrieved successfully"
                  data:
                    type: object
                    properties:
                      overall:
                        $ref: '#/components/schemas/DeliveryStats'
                      deliveryPersons:
                        type: array
                        items:
                          $ref: '#/components/schemas/DeliveryPersonStats'
        '403':
          description: Forbidden - Admin role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/my-orders:
    get:
      summary: Get orders assigned to delivery person
      description: Retrieve orders assigned to the authenticated delivery person
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: status
          schema:
            type: string
            enum: [assigned, out_for_delivery, delivered]
          description: Filter by order status
        - in: query
          name: dateFrom
          schema:
            type: string
            format: date
          description: Start date for filtering (YYYY-MM-DD)
        - in: query
          name: dateTo
          schema:
            type: string
            format: date
          description: End date for filtering (YYYY-MM-DD)
        - in: query
          name: sortBy
          schema:
            type: string
            enum: [assignedAt, status, createdAt]
          description: Sort field
          default: assignedAt
        - in: query
          name: sortOrder
          schema:
            type: string
            enum: [asc, desc]
          description: Sort order
          default: desc
        - in: query
          name: page
          schema:
            type: integer
            minimum: 1
          description: Page number
          default: 1
        - in: query
          name: limit
          schema:
            type: integer
            minimum: 1
            maximum: 100
          description: Items per page
          default: 20
      responses:
        '200':
          description: Delivery orders retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Delivery orders retrieved successfully"
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Order'
                  pagination:
                    $ref: '#/components/schemas/PaginationInfo'
        '403':
          description: Forbidden - Delivery person role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/orders/{orderId}/status:
    put:
      summary: Update delivery status
      description: Update the delivery status of an assigned order (Delivery person only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - status
              properties:
                status:
                  type: string
                  enum: [assigned, out_for_delivery, delivered]
                  description: New delivery status
                estimatedDeliveryTime:
                  type: string
                  format: date-time
                  description: Estimated delivery time
                deliveryNotes:
                  type: string
                  description: Delivery notes
                  maxLength: 500
      responses:
        '200':
          description: Delivery status updated successfully
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OrderResponse'
        '400':
          description: Bad request - Invalid status transition or data
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Delivery person role required or order not assigned to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/orders/{orderId}:
    get:
      summary: Get order details for delivery person
      description: Retrieve detailed information about a specific order assigned to the delivery person
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: orderId
          required: true
          schema:
            type: string
          description: Order ID
      responses:
        '200':
          description: Order details retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Order details retrieved successfully"
                  data:
                    $ref: '#/components/schemas/Order'
        '403':
          description: Forbidden - Delivery person role required or order not assigned to user
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Order not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /delivery/orders/delivered:
    delete:
      summary: Delete delivered orders
      description: Delete delivered orders with optional date filtering (Admin only)
      tags: [Delivery]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: confirmDelete
          required: true
          schema:
            type: string
            enum: ['true']
          description: Confirmation required to proceed with deletion
        - in: query
          name: dateFrom
          required: false
          schema:
            type: string
            format: date
          description: Start date for filtering delivered orders (ISO 8601 format)
        - in: query
          name: dateTo
          required: false
          schema:
            type: string
            format: date
          description: End date for filtering delivered orders (ISO 8601 format)
        - in: query
          name: olderThanDays
          required: false
          schema:
            type: integer
            minimum: 1
          description: Delete orders older than specified number of days
      responses:
        '200':
          description: Delivered orders deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Successfully deleted 5 delivered orders"
                  data:
                    type: object
                    properties:
                      deletedCount:
                        type: integer
                        example: 5
                      deletedOrders:
                        type: array
                        items:
                          type: object
                          properties:
                            orderNumber:
                              type: string
                              example: "TB000001"
                            customerName:
                              type: string
                              example: "John Doe"
                            totalAmount:
                              type: number
                              example: 2500.00
                            deliveredAt:
                              type: string
                              format: date-time
                              example: "2024-01-15T10:30:00.000Z"
        '400':
          description: Bad request - Missing confirmation or invalid parameters
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '403':
          description: Forbidden - Admin role required
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: No delivered orders found matching criteria
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Inventory Management Endpoints
  /inventory/overview:
    get:
      summary: Get inventory overview
      description: Retrieve comprehensive inventory overview with filtering options
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: product
          in: query
          description: Filter by product ID
          required: false
          schema:
            type: string
        - name: category
          in: query
          description: Filter by category ID
          required: false
          schema:
            type: string
        - name: brand
          in: query
          description: Filter by brand name
          required: false
          schema:
            type: string
        - name: lowStockOnly
          in: query
          description: Show only low stock items
          required: false
          schema:
            type: boolean
        - name: outOfStockOnly
          in: query
          description: Show only out of stock items
          required: false
          schema:
            type: boolean
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Inventory overview retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      inventory:
                        type: array
                        items:
                          $ref: '#/components/schemas/InventoryItem'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/low-stock:
    get:
      summary: Get low stock products
      description: Retrieve products with low stock levels
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: threshold
          in: query
          description: Custom low stock threshold
          required: false
          schema:
            type: integer
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Low stock products retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      lowStockProducts:
                        type: array
                        items:
                          $ref: '#/components/schemas/LowStockProduct'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/statistics:
    get:
      summary: Get inventory statistics
      description: Retrieve overall inventory statistics and metrics
      tags: [Inventory]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Inventory statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/InventoryStatistics'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/products/{productId}/movements:
    get:
      summary: Get product stock movements
      description: Retrieve stock movement history for a specific product
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          description: Product ID
          required: true
          schema:
            type: string
        - name: variant
          in: query
          description: Filter by variant ID
          required: false
          schema:
            type: string
        - name: movementType
          in: query
          description: Filter by movement type
          required: false
          schema:
            type: string
            enum: [in, out, adjustment, transfer, reservation, restoration]
        - name: startDate
          in: query
          description: Start date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Stock movements retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movements:
                        type: array
                        items:
                          $ref: '#/components/schemas/StockMovement'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid product ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/variants/{variantId}/movements:
    get:
      summary: Get variant stock movements
      description: Retrieve stock movement history for a specific variant
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: variantId
          in: path
          description: Variant ID
          required: true
          schema:
            type: string
        - name: movementType
          in: query
          description: Filter by movement type
          required: false
          schema:
            type: string
            enum: [in, out, adjustment, transfer, reservation, restoration]
        - name: startDate
          in: query
          description: Start date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: page
          in: query
          description: Page number
          required: false
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          required: false
          schema:
            type: integer
            default: 20
      responses:
        '200':
          description: Stock movements retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      movements:
                        type: array
                        items:
                          $ref: '#/components/schemas/StockMovement'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '400':
          description: Invalid variant ID
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/products/{productId}/variants/{variantId}/stock:
    put:
      summary: Update stock levels
      description: Manually adjust stock levels for a specific variant
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: productId
          in: path
          description: Product ID
          required: true
          schema:
            type: string
        - name: variantId
          in: path
          description: Variant ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
                - reason
              properties:
                quantity:
                  type: number
                  description: Stock adjustment quantity (positive for increase, negative for decrease)
                  example: 10
                reason:
                  type: string
                  description: Reason for stock adjustment
                  example: "Stock adjustment"
                  maxLength: 200
                notes:
                  type: string
                  description: Additional notes
                  example: "Received new shipment"
                  maxLength: 500
                cost:
                  type: number
                  description: Cost per unit
                  example: 25.50
                  minimum: 0
      responses:
        '200':
          description: Stock levels updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Stock levels updated successfully"
                  data:
                    type: object
                    properties:
                      productId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j2"
                      variantId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j3"
                      previousStock:
                        type: number
                        example: 50
                      newStock:
                        type: number
                        example: 60
                      adjustment:
                        type: number
                        example: 10
                      movementId:
                        type: string
                        example: "movement123"
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Product or variant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/transfer/{fromVariantId}/{toVariantId}:
    post:
      summary: Transfer stock between variants
      description: Transfer stock from one variant to another
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: fromVariantId
          in: path
          description: Source variant ID
          required: true
          schema:
            type: string
        - name: toVariantId
          in: path
          description: Destination variant ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - quantity
                - reason
              properties:
                quantity:
                  type: number
                  description: Quantity to transfer
                  example: 5
                  minimum: 1
                reason:
                  type: string
                  description: Reason for transfer
                  example: "Transfer between sizes"
                  maxLength: 200
                notes:
                  type: string
                  description: Additional notes
                  example: "Moving from M to L size"
                  maxLength: 500
      responses:
        '200':
          description: Stock transfer completed successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Stock transfer completed successfully"
                  data:
                    type: object
                    properties:
                      fromVariantId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j3"
                      toVariantId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j4"
                      quantity:
                        type: number
                        example: 5
                      fromPreviousStock:
                        type: number
                        example: 50
                      fromNewStock:
                        type: number
                        example: 45
                      toPreviousStock:
                        type: number
                        example: 30
                      toNewStock:
                        type: number
                        example: 35
                      movements:
                        type: array
                        items:
                          type: string
                        example: ["movement123", "movement124"]
        '400':
          description: Validation error or insufficient stock
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '404':
          description: Variant not found
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/bulk-update:
    post:
      summary: Bulk stock update
      description: Update multiple stock levels at once
      tags: [Inventory]
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - updates
                - reason
              properties:
                updates:
                  type: array
                  description: Array of stock updates
                  items:
                    type: object
                    required:
                      - productId
                      - variantId
                      - quantity
                    properties:
                      productId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j2"
                      variantId:
                        type: string
                        example: "64f1a2b3c4d5e6f7g8h9i0j3"
                      quantity:
                        type: number
                        example: 10
                  maxItems: 100
                reason:
                  type: string
                  description: Reason for bulk update
                  example: "Bulk import"
                  maxLength: 200
                notes:
                  type: string
                  description: Additional notes
                  example: "Monthly stock update"
                  maxLength: 500
      responses:
        '200':
          description: Bulk update completed
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Bulk update completed. 2 successful, 0 failed."
                  data:
                    type: object
                    properties:
                      successful:
                        type: array
                        items:
                          type: object
                          properties:
                            productId:
                              type: string
                            variantId:
                              type: string
                            previousStock:
                              type: number
                            newStock:
                              type: number
                            adjustment:
                              type: number
                            movementId:
                              type: string
                      failed:
                        type: array
                        items:
                          type: object
                          properties:
                            productId:
                              type: string
                            variantId:
                              type: string
                            error:
                              type: string
                      summary:
                        type: object
                        properties:
                          total:
                            type: integer
                          successful:
                            type: integer
                          failed:
                            type: integer
        '400':
          description: Validation error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /inventory/summary:
    get:
      summary: Get inventory summary
      description: Get inventory summary with movement statistics
      tags: [Inventory]
      security:
        - bearerAuth: []
      parameters:
        - name: product
          in: query
          description: Filter by product ID
          required: false
          schema:
            type: string
        - name: variant
          in: query
          description: Filter by variant ID
          required: false
          schema:
            type: string
        - name: startDate
          in: query
          description: Start date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date filter (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: Inventory summary retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: array
                    items:
                      type: object
                      properties:
                        productId:
                          type: string
                          example: "64f1a2b3c4d5e6f7g8h9i0j2"
                        variantId:
                          type: string
                          example: "64f1a2b3c4d5e6f7g8h9i0j3"
                        productName:
                          type: string
                          example: "Premium Cotton T-Shirt"
                        brand:
                          type: string
                          example: "TrendBite"
                        movements:
                          type: array
                          items:
                            type: object
                            properties:
                              type:
                                type: string
                                example: "out"
                              quantity:
                                type: number
                                example: -120
                              count:
                                type: integer
                                example: 45
                        totalMovements:
                          type: integer
                          example: 57
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Admin Inventory Dashboard Endpoints
  /admin/dashboard/inventory:
    get:
      summary: Get inventory dashboard overview
      description: Retrieve comprehensive inventory dashboard with key metrics, low stock alerts, and recent movements
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Inventory dashboard retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      inventoryStats:
                        $ref: '#/components/schemas/InventoryStatistics'
                      lowStockProducts:
                        type: array
                        items:
                          $ref: '#/components/schemas/LowStockProduct'
                      recentMovements:
                        type: array
                        items:
                          $ref: '#/components/schemas/StockMovement'
                      outOfStockCount:
                        type: integer
                        example: 5
                      totalInventoryValue:
                        type: number
                        example: 125000.50
                      movementSummary:
                        type: array
                        items:
                          type: object
                          properties:
                            _id:
                              type: string
                              example: "out"
                            count:
                              type: integer
                              example: 45
                            totalQuantity:
                              type: number
                              example: -120
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/inventory/alerts:
    get:
      summary: Get inventory alerts
      description: Retrieve inventory alerts including low stock, out of stock, and stale inventory warnings
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      parameters:
        - name: limit
          in: query
          description: Number of alerts to return
          required: false
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: Inventory alerts retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      lowStockAlerts:
                        type: array
                        items:
                          type: object
                          properties:
                            product:
                              type: object
                              properties:
                                _id:
                                  type: string
                                name:
                                  type: string
                                brand:
                                  type: string
                            variant:
                              type: string
                            currentStock:
                              type: number
                            lowStockThreshold:
                              type: number
                            stockPercentage:
                              type: number
                      outOfStockAlerts:
                        type: array
                        items:
                          type: object
                          properties:
                            product:
                              type: object
                              properties:
                                _id:
                                  type: string
                                name:
                                  type: string
                                brand:
                                  type: string
                            variant:
                              type: string
                            lastSold:
                              type: string
                              format: date-time
                            updatedAt:
                              type: string
                              format: date-time
                      staleInventory:
                        type: array
                        items:
                          type: object
                          properties:
                            productId:
                              type: string
                            productName:
                              type: string
                            brand:
                              type: string
                            variant:
                              type: string
                            currentStock:
                              type: number
                            lastSold:
                              type: string
                              format: date-time
                            updatedAt:
                              type: string
                              format: date-time
                      summary:
                        type: object
                        properties:
                          lowStockCount:
                            type: integer
                          outOfStockCount:
                            type: integer
                          staleInventoryCount:
                            type: integer
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /admin/inventory/reports:
    get:
      summary: Get inventory reports
      description: Generate various inventory reports including overview, movements, low stock, and valuation reports
      tags: [Admin Dashboard]
      security:
        - bearerAuth: []
      parameters:
        - name: reportType
          in: query
          description: Type of report
          required: false
          schema:
            type: string
            enum: [overview, movements, low-stock, valuation]
            default: overview
        - name: startDate
          in: query
          description: Start date for report (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date for report (ISO 8601 format)
          required: false
          schema:
            type: string
            format: date-time
        - name: category
          in: query
          description: Filter by category ID
          required: false
          schema:
            type: string
        - name: brand
          in: query
          description: Filter by brand name
          required: false
          schema:
            type: string
        - name: lowStockOnly
          in: query
          description: Show only low stock items
          required: false
          schema:
            type: boolean
        - name: outOfStockOnly
          in: query
          description: Show only out of stock items
          required: false
          schema:
            type: boolean
      responses:
        '200':
          description: Inventory report generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      reportType:
                        type: string
                        example: "overview"
                      filters:
                        type: object
                        properties:
                          startDate:
                            type: string
                            format: date-time
                          endDate:
                            type: string
                            format: date-time
                          category:
                            type: string
                          brand:
                            type: string
                          lowStockOnly:
                            type: boolean
                          outOfStockOnly:
                            type: boolean
                      reportData:
                        type: object
                        description: Report data structure varies by report type
                      generatedAt:
                        type: string
                        format: date-time
        '400':
          description: Invalid report type
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '401':
          description: Unauthorized
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        '500':
          description: Internal server error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  # Payment Management Endpoints
  /payments/admin/all:
    get:
      summary: Get all COD payments with filtering
      description: Retrieve all COD payments with comprehensive filtering, pagination, and search capabilities
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          description: Page number
          schema:
            type: integer
            default: 1
        - name: limit
          in: query
          description: Items per page
          schema:
            type: integer
            default: 20
        - name: status
          in: query
          description: Filter by payment status
          schema:
            type: string
            enum: [pending, paid_on_delivery, completed, failed, partial]
        - name: collectionStatus
          in: query
          description: Filter by collection status
          schema:
            type: string
            enum: [not_collected, collected, partial_collected, failed_collection]
        - name: deliveryPersonId
          in: query
          description: Filter by delivery person ID
          schema:
            type: string
        - name: isOutstanding
          in: query
          description: Filter outstanding payments
          schema:
            type: boolean
        - name: startDate
          in: query
          description: Start date filter (ISO 8601 format)
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date filter (ISO 8601 format)
          schema:
            type: string
            format: date-time
        - name: search
          in: query
          description: Search by order number, customer name, or delivery person name
          schema:
            type: string
      responses:
        '200':
          description: Payments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payments retrieved successfully"
                  data:
                    type: object
                    properties:
                      payments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Payment'
                      pagination:
                        $ref: '#/components/schemas/Pagination'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/admin/statistics:
    get:
      summary: Get payment statistics
      description: Retrieve comprehensive payment statistics for admin dashboard with period-based filtering
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: period
          in: query
          description: Time period for statistics
          schema:
            type: string
            enum: [day, week, month, year]
            default: month
      responses:
        '200':
          description: Payment statistics retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment statistics retrieved successfully"
                  data:
                    type: object
                    properties:
                      statistics:
                        $ref: '#/components/schemas/PaymentStatistics'
                      recentActivities:
                        type: array
                        items:
                          $ref: '#/components/schemas/PaymentActivity'
                      period:
                        type: string
                        example: "month"
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/admin/reports:
    get:
      summary: Generate payment reports
      description: Generate detailed payment reports with various filters and report types
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: startDate
          in: query
          description: Start date for report (ISO 8601 format)
          required: true
          schema:
            type: string
            format: date-time
        - name: endDate
          in: query
          description: End date for report (ISO 8601 format)
          required: true
          schema:
            type: string
            format: date-time
        - name: reportType
          in: query
          description: Type of report
          schema:
            type: string
            enum: [summary, detailed, outstanding]
            default: summary
        - name: deliveryPersonId
          in: query
          description: Filter by delivery person ID
          schema:
            type: string
        - name: status
          in: query
          description: Filter by payment status
          schema:
            type: string
      responses:
        '200':
          description: Payment report generated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment report generated successfully"
                  data:
                    type: object
                    properties:
                      reportType:
                        type: string
                        example: "detailed"
                      dateRange:
                        type: object
                        properties:
                          startDate:
                            type: string
                            format: date-time
                          endDate:
                            type: string
                            format: date-time
                      filters:
                        type: object
                        properties:
                          deliveryPersonId:
                            type: string
                          status:
                            type: string
                      report:
                        type: array
                        items:
                          $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/admin/{paymentId}:
    get:
      summary: Get payment by ID
      description: Retrieve detailed information for a specific payment
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: paymentId
          in: path
          description: Payment ID
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Payment retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment retrieved successfully"
                  data:
                    type: object
                    properties:
                      payment:
                        $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/admin/{paymentId}/mark-received:
    put:
      summary: Mark payment as received
      description: Manually mark a payment as received/collected by admin
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: paymentId
          in: path
          description: Payment ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  example: 2500.00
                  description: Amount received
                notes:
                  type: string
                  example: "Payment received via bank transfer"
                  description: Collection notes
              required:
                - amount
      responses:
        '200':
          description: Payment marked as received successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment marked as received successfully"
                  data:
                    type: object
                    properties:
                      payment:
                        $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/admin/{paymentId}/update:
    put:
      summary: Update payment details
      description: Update payment details including admin notes, collection issues, and issue descriptions
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: paymentId
          in: path
          description: Payment ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                adminNotes:
                  type: string
                  example: "Customer contacted, will pay next week"
                  description: Admin notes
                collectionIssues:
                  type: array
                  items:
                    type: string
                    enum: [customer_not_available, customer_refused, address_incorrect, insufficient_cash, other]
                  example: ["customer_not_available"]
                  description: Collection issues
                issueDescription:
                  type: string
                  example: "Customer is traveling, will be back next week"
                  description: Issue description
      responses:
        '200':
          description: Payment details updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment details updated successfully"
                  data:
                    type: object
                    properties:
                      payment:
                        $ref: '#/components/schemas/Payment'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/delivery/my-payments:
    get:
      summary: Get assigned payments
      description: Retrieve payments assigned to the authenticated delivery person
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: status
          in: query
          description: Filter by payment status
          schema:
            type: string
        - name: isOutstanding
          in: query
          description: Filter outstanding payments
          schema:
            type: boolean
      responses:
        '200':
          description: Assigned payments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Assigned payments retrieved successfully"
                  data:
                    type: object
                    properties:
                      payments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Payment'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/delivery/{paymentId}/collect:
    post:
      summary: Collect payment
      description: Record payment collection during delivery (full or partial payment)
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: paymentId
          in: path
          description: Payment ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                amount:
                  type: number
                  example: 2500.00
                  description: Amount collected
                notes:
                  type: string
                  example: "Customer paid exact amount in cash"
                  description: Collection notes
              required:
                - amount
      responses:
        '200':
          description: Payment collected successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Payment collected successfully"
                  data:
                    type: object
                    properties:
                      payment:
                        $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/delivery/{paymentId}/report-issue:
    post:
      summary: Report collection issue
      description: Report issues encountered during payment collection attempt
      tags: [Payments]
      security:
        - bearerAuth: []
      parameters:
        - name: paymentId
          in: path
          description: Payment ID
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                issues:
                  type: array
                  items:
                    type: string
                    enum: [customer_not_available, customer_refused, address_incorrect, insufficient_cash, other]
                  example: ["customer_not_available", "address_incorrect"]
                  description: Collection issues
                description:
                  type: string
                  example: "Customer not home and address seems incorrect. Left delivery note with contact information."
                  description: Issue description
              required:
                - issues
      responses:
        '200':
          description: Collection issue reported successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Collection issue reported successfully"
                  data:
                    type: object
                    properties:
                      payment:
                        $ref: '#/components/schemas/Payment'
        '400':
          $ref: '#/components/responses/BadRequestError'
        '404':
          $ref: '#/components/responses/NotFoundError'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

  /payments/outstanding:
    get:
      summary: Get outstanding payments
      description: Get outstanding payments (all for admin, assigned only for delivery person)
      tags: [Payments]
      security:
        - bearerAuth: []
      responses:
        '200':
          description: Outstanding payments retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: "Outstanding payments retrieved successfully"
                  data:
                    type: object
                    properties:
                      payments:
                        type: array
                        items:
                          $ref: '#/components/schemas/Payment'
        '401':
          $ref: '#/components/responses/UnauthorizedError'
        '403':
          $ref: '#/components/responses/ForbiddenError'
        '500':
          $ref: '#/components/responses/InternalServerError'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT token obtained from login or registration.
        Include the token in the Authorization header as: `Bearer <token>`

  schemas:
    User:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Unique user identifier
        firstName:
          type: string
          example: John
          description: User's first name
        lastName:
          type: string
          example: Doe
          description: User's last name
        fullName:
          type: string
          example: John Doe
          description: User's full name (computed field)
        email:
          type: string
          format: email
          example: john.doe@example.com
          description: User's email address
        role:
          type: string
          enum: [customer, admin, deliveryperson]
          example: customer
          description: User's role in the system
        avatar:
          type: object
          properties:
            public_id:
              type: string
              example: trendbite/users/avatars/avatar_1234567890_abc123
              description: Cloudinary public ID
            url:
              type: string
              example: https://res.cloudinary.com/trendbite/image/upload/v1234567890/trendbite/users/avatars/avatar_1234567890_abc123.jpg
              description: Avatar image URL
        phone:
          type: string
          example: "+1234567890"
          description: User's phone number
        address:
          type: object
          properties:
            street:
              type: string
              example: "123 Main St"
              description: Street address
            city:
              type: string
              example: "New York"
              description: City
            state:
              type: string
              example: "NY"
              description: State
            zipCode:
              type: string
              example: "10001"
              description: ZIP code
            country:
              type: string
              example: "US"
              description: Country
        dateOfBirth:
          type: string
          format: date
          example: "1990-01-01"
          description: User's date of birth
        gender:
          type: string
          enum: [male, female, other, prefer-not-to-say]
          example: male
          description: User's gender
        isEmailVerified:
          type: boolean
          example: false
          description: Email verification status
        isActive:
          type: boolean
          example: true
          description: Account active status
        lastLogin:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last login timestamp
        preferences:
          type: object
          properties:
            newsletter:
              type: boolean
              example: true
              description: Newsletter subscription preference
            notifications:
              type: boolean
              example: true
              description: Notification preference
        deliveryStats:
          type: object
          properties:
            averageRating:
              type: number
              minimum: 0
              maximum: 5
              example: 4.8
              description: Average delivery rating (for delivery persons only)
            totalRatings:
              type: integer
              minimum: 0
              example: 157
              description: Total number of ratings received (for delivery persons only)
            totalDeliveries:
              type: integer
              minimum: 0
              example: 200
              description: Total deliveries completed (for delivery persons only)
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
          description: Account creation timestamp
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last update timestamp

    Product:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Unique product identifier
        name:
          type: string
          example: "Premium Cotton T-Shirt"
          description: Product name
        slug:
          type: string
          example: "premium-cotton-t-shirt"
          description: URL-friendly product identifier
        description:
          type: string
          example: "High-quality cotton t-shirt perfect for everyday wear"
          description: Detailed product description
        shortDescription:
          type: string
          example: "Comfortable cotton t-shirt"
          description: Brief product description
        brand:
          type: string
          example: "TrendBite"
          description: Product brand
        category:
          type: object
          properties:
            _id:
              type: string
            name:
              type: string
            slug:
              type: string
            path:
              type: string
          description: Product category information
        gender:
          type: string
          enum: [men, women, unisex]
          example: "unisex"
          description: Target gender
        material:
          type: string
          example: "100% Cotton"
          description: Product material
        tags:
          type: array
          items:
            type: string
          example: ["casual", "cotton", "comfortable"]
          description: Product tags
        suitableSkinTone:
          type: array
          items:
            type: object
            properties:
              name:
                type: string
                example: "Fair"
              hex:
                type: string
                example: "#FFE0BD"
          example: [{"name": "Fair", "hex": "#FFE0BD"}, {"name": "Medium", "hex": "#C68642"}]
          description: Suitable skin tones for the product (optional)
        variants:
          type: array
          items:
            type: object
            properties:
              _id:
                type: string
              size:
                type: string
                example: "M"
              color:
                type: object
                properties:
                  name:
                    type: string
                    example: "Red"
                  hex:
                    type: string
                    example: "#FF0000"
              sku:
                type: string
                example: "TSHIRT-M-RED-001"
              stockQuantity:
                type: number
                example: 50
              price:
                type: object
                properties:
                  regular:
                    type: number
                    example: 29.99
                  sale:
                    type: number
                    example: 24.99
              weight:
                type: number
                example: 0.2
              dimensions:
                type: object
                properties:
                  length:
                    type: number
                    example: 70
                  width:
                    type: number
                    example: 50
                  height:
                    type: number
                    example: 1
                  unit:
                    type: string
                    example: "cm"
              images:
                type: array
                items:
                  type: object
                  properties:
                    public_id:
                      type: string
                    url:
                      type: string
                    alt:
                      type: string
                    order:
                      type: number
              isActive:
                type: boolean
                example: true
        images:
          type: array
          items:
            type: object
            properties:
              public_id:
                type: string
              url:
                type: string
              alt:
                type: string
              order:
                type: number
              isMain:
                type: boolean
        status:
          type: string
          enum: [draft, published, archived]
          example: "published"
          description: Product status
        isActive:
          type: boolean
          example: true
          description: Product active status
        isFeatured:
          type: boolean
          example: false
          description: Featured product status
        discountPercentage:
          type: number
          example: 0
          description: Discount percentage
        bulkPricing:
          type: array
          items:
            type: object
            properties:
              minQuantity:
                type: number
                example: 2
              maxQuantity:
                type: number
                example: 5
              discountType:
                type: string
                enum: [percentage, fixed]
                example: "percentage"
              discountValue:
                type: number
                example: 10
        currency:
          type: string
          enum: [USD, LKR, EUR, GBP]
          example: "USD"
          description: Product currency
        lowStockThreshold:
          type: number
          example: 10
          description: Low stock threshold
        totalStock:
          type: number
          example: 150
          description: Total stock across all variants
        totalSales:
          type: number
          example: 25
          description: Total sales count
        averageRating:
          type: number
          example: 4.5
          description: Average product rating
        reviewCount:
          type: number
          example: 12
          description: Number of reviews
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
          description: Product creation timestamp
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last update timestamp

    Category:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Unique category identifier
        name:
          type: string
          example: "T-Shirts"
          description: Category name
        slug:
          type: string
          example: "t-shirts"
          description: URL-friendly category identifier
        description:
          type: string
          example: "Comfortable and stylish t-shirts"
          description: Category description
        parent:
          type: object
          properties:
            _id:
              type: string
            name:
              type: string
            slug:
              type: string
            path:
              type: string
          description: Parent category information
        level:
          type: number
          example: 1
          description: Category hierarchy level
        path:
          type: string
          example: "Men's > T-Shirts"
          description: Full category path
        image:
          type: object
          properties:
            public_id:
              type: string
            url:
              type: string
          description: Category image
        isActive:
          type: boolean
          example: true
          description: Category active status
        sortOrder:
          type: number
          example: 0
          description: Sort order
        seoTitle:
          type: string
          example: "Men's T-Shirts - TrendBite"
          description: SEO title
        seoDescription:
          type: string
          example: "Shop comfortable men's t-shirts at TrendBite"
          description: SEO description
        seoKeywords:
          type: array
          items:
            type: string
          example: ["men's t-shirts", "cotton shirts", "casual wear"]
          description: SEO keywords
        children:
          type: array
          items:
            $ref: '#/components/schemas/Category'
          description: Subcategories
        productsCount:
          type: number
          example: 25
          description: Number of products in this category
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
          description: Category creation timestamp
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last update timestamp

    Order:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6789012346"
          description: Unique order identifier
        orderNumber:
          type: string
          example: "TB000001"
          description: Human-readable order number
        customer:
          type: object
          properties:
            _id:
              type: string
              example: "64a1b2c3d4e5f6789012347"
            firstName:
              type: string
              example: "John"
            lastName:
              type: string
              example: "Doe"
            email:
              type: string
              example: "john@example.com"
            phone:
              type: string
              example: "+94771234567"
          description: Customer information
        status:
          type: string
          enum: [pending, confirmed, shipped, assigned, out_for_delivery, delivered, completed, cancelled]
          example: "pending"
          description: Current order status
        statusDisplay:
          type: string
          example: "Pending"
          description: Human-readable status display
        items:
          type: array
          items:
            type: object
            properties:
              product:
                type: object
                properties:
                  _id:
                    type: string
                    example: "64a1b2c3d4e5f6789012345"
                  name:
                    type: string
                    example: "Cotton T-Shirt"
                  brand:
                    type: string
                    example: "TrendBite"
                  images:
                    type: array
                    items:
                      type: object
                      properties:
                        public_id:
                          type: string
                        url:
                          type: string
                        alt:
                          type: string
                        isMain:
                          type: boolean
              variant:
                type: object
                properties:
                  size:
                    type: string
                    example: "M"
                  color:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "Blue"
                      hex:
                        type: string
                        example: "#0000FF"
                  sku:
                    type: string
                    example: "TB-SHIRT-M-BLUE-001"
              quantity:
                type: integer
                example: 2
              unitPrice:
                type: number
                example: 1000
              totalPrice:
                type: number
                example: 2000
        subtotal:
          type: number
          example: 2000
          description: Order subtotal before delivery and discounts
        deliveryCost:
          type: number
          example: 400
          description: |
            Delivery cost based on shipping method:
            - Standard: 400 LKR
            - Express: 1000 LKR
        discount:
          type: object
          properties:
            code:
              type: string
              example: "WELCOME10"
            amount:
              type: number
              example: 200
            type:
              type: string
              enum: [percentage, fixed]
              example: "fixed"
        totalAmount:
          type: number
          example: 2200
          description: Final order amount
        deliveryAddress:
          type: object
          properties:
            street:
              type: string
              example: "123 Main Street"
            city:
              type: string
              example: "Colombo"
            state:
              type: string
              example: "Western Province"
            zipCode:
              type: string
              example: "00100"
            country:
              type: string
              example: "Sri Lanka"
            phone:
              type: string
              example: "+94771234567"
        billingAddress:
          type: object
          properties:
            street:
              type: string
              example: "123 Main Street"
            city:
              type: string
              example: "Colombo"
            state:
              type: string
              example: "Western Province"
            zipCode:
              type: string
              example: "00100"
            country:
              type: string
              example: "Sri Lanka"
        payment:
          type: object
          properties:
            method:
              type: string
              enum: [cash_on_delivery, credit_card, debit_card, bank_transfer, digital_wallet]
              example: "cash_on_delivery"
            status:
              type: string
              enum: [pending, paid, failed, refunded, partially_refunded]
              example: "pending"
            transactionId:
              type: string
              example: "TXN123456789"
            paidAt:
              type: string
              format: date-time
              example: "2024-01-15T10:30:00.000Z"
        shipping:
          type: object
          properties:
            method:
              type: string
              enum: [standard, express]
              example: "standard"
              description: |
                Shipping method:
                - `standard`: 3 working days (400 LKR)
                - `express`: Within 1 day (1000 LKR)
            trackingNumber:
              type: string
              example: "TB123456789"
            estimatedDeliveryDate:
              type: string
              format: date-time
              example: "2024-01-20T18:00:00.000Z"
              description: Automatically calculated based on shipping method
            actualDeliveryDate:
              type: string
              format: date-time
              example: "2024-01-20T16:30:00.000Z"
            deliveryPartner:
              type: string
              example: "Express Delivery"
        deliveryRating:
          $ref: '#/components/schemas/DeliveryRating'
        statusHistory:
          type: array
          items:
            type: object
            properties:
              status:
                type: string
                example: "pending"
              changedAt:
                type: string
                format: date-time
                example: "2024-01-15T10:30:00.000Z"
              changedBy:
                type: object
                properties:
                  _id:
                    type: string
                  firstName:
                    type: string
                  lastName:
                    type: string
              notes:
                type: string
                example: "Order created"
        notes:
          type: string
          example: "Please deliver after 6 PM"
          description: Order notes
        currency:
          type: string
          enum: [LKR, USD, EUR, GBP]
          example: "LKR"
          description: Order currency
        createdAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Order creation timestamp
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last update timestamp

    Discount:
      type: object
      properties:
        _id:
          type: string
          example: "64a1b2c3d4e5f6789012349"
          description: Unique discount identifier
        code:
          type: string
          example: "WELCOME10"
          description: Discount code
        name:
          type: string
          example: "Welcome Discount"
          description: Discount name
        description:
          type: string
          example: "10% off for new customers"
          description: Discount description
        type:
          type: string
          enum: [percentage, fixed]
          example: "fixed"
          description: Discount type
        value:
          type: number
          example: 200
          description: Discount value
        displayValue:
          type: string
          example: "LKR 200"
          description: Human-readable discount value
        minimumOrderAmount:
          type: number
          example: 1000
          description: Minimum order amount required
        maximumDiscountAmount:
          type: number
          example: 500
          description: Maximum discount amount
        usageLimit:
          type: integer
          example: 100
          description: Maximum usage limit
        usedCount:
          type: integer
          example: 25
          description: Current usage count
        usedBy:
          type: array
          description: Array of users who have used this discount
          items:
            type: object
            properties:
              user:
                $ref: '#/components/schemas/User'
              usedAt:
                type: string
                format: date-time
                example: "2024-01-15T10:30:00.000Z"
                description: When the user used the discount
        remainingUsage:
          type: integer
          example: 75
          description: Remaining usage count
        validFrom:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
          description: Valid from date
        validUntil:
          type: string
          format: date-time
          example: "2024-12-31T23:59:59.000Z"
          description: Valid until date
        applicableProducts:
          type: array
          items:
            type: object
            properties:
              _id:
                type: string
              name:
                type: string
          example: [{"_id": "64a1b2c3d4e5f6789012345", "name": "Cotton T-Shirt"}]
          description: Applicable products
        applicableCategories:
          type: array
          items:
            type: object
            properties:
              _id:
                type: string
              name:
                type: string
          example: [{"_id": "64a1b2c3d4e5f678901234a", "name": "T-Shirts"}]
          description: Applicable categories
        applicableUsers:
          type: array
          items:
            type: object
            properties:
              _id:
                type: string
              firstName:
                type: string
              lastName:
                type: string
              email:
                type: string
          example: []
          description: Applicable users (empty for all users)
        isActive:
          type: boolean
          example: true
          description: Whether discount is active
        isPublic:
          type: boolean
          example: true
          description: Whether discount is public
        isValid:
          type: boolean
          example: true
          description: Whether discount is currently valid
        createdBy:
          type: object
          properties:
            _id:
              type: string
            firstName:
              type: string
            lastName:
              type: string
          description: Admin who created the discount
        createdAt:
          type: string
          format: date-time
          example: "2024-01-01T00:00:00.000Z"
          description: Discount creation timestamp
        updatedAt:
          type: string
          format: date-time
          example: "2024-01-15T10:30:00.000Z"
          description: Last update timestamp

    Pagination:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
          description: Current page number
        totalPages:
          type: integer
          example: 5
          description: Total number of pages
        totalUsers:
          type: integer
          example: 50
          description: Total number of users
        hasNextPage:
          type: boolean
          example: true
          description: Whether there is a next page
        hasPrevPage:
          type: boolean
          example: false
          description: Whether there is a previous page

    PaginationInfo:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
          description: Current page number
        totalPages:
          type: integer
          example: 5
          description: Total number of pages
        totalItems:
          type: integer
          example: 50
          description: Total number of items
        hasNextPage:
          type: boolean
          example: true
          description: Whether there is a next page
        hasPrevPage:
          type: boolean
          example: false
          description: Whether there is a previous page

    OrderPagination:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
          description: Current page number
        totalPages:
          type: integer
          example: 3
          description: Total number of pages
        totalOrders:
          type: integer
          example: 25
          description: Total number of orders
        hasNextPage:
          type: boolean
          example: true
          description: Whether there is a next page
        hasPrevPage:
          type: boolean
          example: false
          description: Whether there is a previous page

    DiscountPagination:
      type: object
      properties:
        currentPage:
          type: integer
          example: 1
          description: Current page number
        totalPages:
          type: integer
          example: 2
          description: Total number of pages
        totalDiscounts:
          type: integer
          example: 10
          description: Total number of discount codes
        hasNextPage:
          type: boolean
          example: true
          description: Whether there is a next page
        hasPrevPage:
          type: boolean
          example: false
          description: Whether there is a previous page

    InventoryItem:
      type: object
      properties:
        productId:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j2"
          description: Product ID
        productName:
          type: string
          example: "Premium Cotton T-Shirt"
          description: Product name
        brand:
          type: string
          example: "TrendBite"
          description: Product brand
        category:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j1"
          description: Category ID
        variant:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j3"
          description: Variant ID
        currentStock:
          type: number
          example: 50
          description: Current stock quantity
        reservedStock:
          type: number
          example: 5
          description: Reserved stock quantity
        availableStock:
          type: number
          example: 45
          description: Available stock quantity
        lowStockThreshold:
          type: number
          example: 10
          description: Low stock threshold
        isLowStock:
          type: boolean
          example: false
          description: Whether stock is low
        isOutOfStock:
          type: boolean
          example: false
          description: Whether stock is out
        stockStatus:
          type: string
          enum: [in_stock, low_stock, out_of_stock]
          example: "in_stock"
          description: Stock status
        stockPercentage:
          type: number
          example: 500
          description: Stock percentage relative to threshold
        lastRestocked:
          type: string
          format: date-time
          example: "2023-09-10T10:00:00Z"
          description: Last restock date
        lastSold:
          type: string
          format: date-time
          example: "2023-09-15T14:30:00Z"
          description: Last sale date
        totalValue:
          type: number
          example: 1250.00
          description: Total inventory value
        updatedAt:
          type: string
          format: date-time
          example: "2023-09-15T14:30:00Z"
          description: Last update date

    LowStockProduct:
      type: object
      properties:
        productId:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j2"
          description: Product ID
        productName:
          type: string
          example: "Premium Cotton T-Shirt"
          description: Product name
        brand:
          type: string
          example: "TrendBite"
          description: Product brand
        categoryName:
          type: string
          example: "T-Shirts"
          description: Category name
        variant:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j3"
          description: Variant ID
        currentStock:
          type: number
          example: 5
          description: Current stock quantity
        lowStockThreshold:
          type: number
          example: 10
          description: Low stock threshold
        stockPercentage:
          type: number
          example: 50
          description: Stock percentage relative to threshold
        lastRestocked:
          type: string
          format: date-time
          example: "2023-09-10T10:00:00Z"
          description: Last restock date
        lastSold:
          type: string
          format: date-time
          example: "2023-09-15T14:30:00Z"
          description: Last sale date
        updatedAt:
          type: string
          format: date-time
          example: "2023-09-15T14:30:00Z"
          description: Last update date

    InventoryStatistics:
      type: object
      properties:
        totalProducts:
          type: integer
          example: 120
          description: Total number of products
        totalStock:
          type: number
          example: 2500
          description: Total stock quantity
        totalReserved:
          type: number
          example: 150
          description: Total reserved stock
        totalAvailable:
          type: number
          example: 2350
          description: Total available stock
        totalValue:
          type: number
          example: 125000.50
          description: Total inventory value
        lowStockCount:
          type: integer
          example: 15
          description: Number of low stock products
        outOfStockCount:
          type: integer
          example: 5
          description: Number of out of stock products
        inStockCount:
          type: integer
          example: 100
          description: Number of in stock products

    StockMovement:
      type: object
      properties:
        _id:
          type: string
          example: "movement123"
          description: Movement ID
        product:
          type: object
          properties:
            _id:
              type: string
              example: "64f1a2b3c4d5e6f7g8h9i0j2"
            name:
              type: string
              example: "Premium Cotton T-Shirt"
            brand:
              type: string
              example: "TrendBite"
          description: Product information
        variant:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j3"
          description: Variant ID
        movementType:
          type: string
          enum: [in, out, adjustment, transfer, reservation, restoration]
          example: "out"
          description: Type of movement
        quantity:
          type: number
          example: -2
          description: Movement quantity (positive for in, negative for out)
        previousStock:
          type: number
          example: 52
          description: Stock level before movement
        newStock:
          type: number
          example: 50
          description: Stock level after movement
        reason:
          type: string
          example: "Order placed - Order #TB000123"
          description: Reason for movement
        reference:
          type: object
          properties:
            type:
              type: string
              example: "order"
              description: Reference type
            id:
              type: string
              example: "order123"
              description: Reference ID
            number:
              type: string
              example: "TB000123"
              description: Reference number
          description: Reference information
        performedBy:
          type: object
          properties:
            _id:
              type: string
              example: "64f1a2b3c4d5e6f7g8h9i0j1"
            firstName:
              type: string
              example: "John"
            lastName:
              type: string
              example: "Doe"
            email:
              type: string
              example: "john@example.com"
          description: User who performed the action
        notes:
          type: string
          example: "Additional notes"
          description: Additional notes
        cost:
          type: number
          example: 25.50
          description: Cost per unit
        createdAt:
          type: string
          format: date-time
          example: "2023-09-15T14:30:00Z"
          description: Movement creation date

    ErrorResponse:
      type: object
      properties:
        success:
          type: boolean
          example: false
          description: Indicates if the request was successful
        message:
          type: string
          example: Error message
          description: Error message describing what went wrong
        errors:
          type: array
          items:
            type: string
          example: ["Email is required", "Password must be at least 6 characters"]
          description: Array of validation errors (optional)

    ValidationError:
      type: object
      properties:
        success:
          type: boolean
          example: false
        message:
          type: string
          example: Validation failed
        errors:
          type: array
          items:
            type: string
          example: ["First name is required", "Email format is invalid"]

    Review:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Review ID
        user:
          type: object
          properties:
            _id:
              type: string
              example: 507f1f77bcf86cd799439012
            firstName:
              type: string
              example: John
            lastName:
              type: string
              example: Doe
            avatar:
              type: object
              properties:
                url:
                  type: string
                  example: https://example.com/avatar.jpg
        product:
          type: object
          properties:
            _id:
              type: string
              example: 507f1f77bcf86cd799439013
            name:
              type: string
              example: Premium T-Shirt
            brand:
              type: string
              example: TrendBite
            images:
              type: array
              items:
                type: object
                properties:
                  url:
                    type: string
                    example: https://example.com/product.jpg
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
          description: Rating from 1 to 5 stars
        title:
          type: string
          example: Excellent product!
          description: Review title
        description:
          type: string
          example: This product exceeded my expectations. Great quality and fast delivery.
          description: Review description
        status:
          type: string
          enum: [pending, approved, rejected]
          example: approved
          description: Review status
        statusDisplay:
          type: string
          example: Approved
          description: Human-readable status
        ratingDisplay:
          type: string
          example: 
          description: Star representation of rating
        adminReply:
          type: object
          properties:
            message:
              type: string
              example: Thank you for your feedback!
              description: Admin reply message
            repliedBy:
              type: object
              properties:
                _id:
                  type: string
                  example: 507f1f77bcf86cd799439014
                firstName:
                  type: string
                  example: Admin
                lastName:
                  type: string
                  example: User
            repliedAt:
              type: string
              format: date-time
              example: 2024-01-15T10:30:00Z
              description: When the admin replied
        isEdited:
          type: boolean
          example: false
          description: Whether the review has been edited
        editedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When the review was last edited
        isActive:
          type: boolean
          example: true
          description: Whether the review is active
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When the review was created
        updatedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When the review was last updated

    ReviewStats:
      type: object
      properties:
        totalReviews:
          type: integer
          example: 25
          description: Total number of approved reviews
        averageRating:
          type: number
          format: float
          example: 4.2
          description: Average rating (rounded to 1 decimal place)
        ratingDistribution:
          type: object
          properties:
            "1":
              type: integer
              example: 1
              description: Number of 1-star reviews
            "2":
              type: integer
              example: 2
              description: Number of 2-star reviews
            "3":
              type: integer
              example: 5
              description: Number of 3-star reviews
            "4":
              type: integer
              example: 8
              description: Number of 4-star reviews
            "5":
              type: integer
              example: 9
              description: Number of 5-star reviews

    CartItem:
      type: object
      properties:
        _id:
          type: string
          description: Cart item ID
          example: 507f1f77bcf86cd799439011
        product:
          type: string
          description: Product ID
          example: 507f1f77bcf86cd799439012
        variant:
          type: object
          properties:
            size:
              type: string
              example: "M"
              description: Product size
            color:
              type: object
              properties:
                name:
                  type: string
                  example: "Blue"
                  description: Color name
                hex:
                  type: string
                  example: "#0000FF"
                  description: Color hex code
            sku:
              type: string
              example: "TSHIRT-M-BLUE-001"
              description: Product SKU
        quantity:
          type: integer
          minimum: 1
          maximum: 10
          example: 2
          description: Item quantity
        unitPrice:
          type: number
          example: 25.99
          description: Unit price of the item
        totalPrice:
          type: number
          example: 51.98
          description: Total price for this item (unitPrice * quantity)
        addedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When the item was added to cart

    Cart:
      type: object
      properties:
        _id:
          type: string
          description: Cart ID
          example: 507f1f77bcf86cd799439013
        user:
          type: string
          description: User ID
          example: 507f1f77bcf86cd799439014
        items:
          type: array
          items:
            $ref: '#/components/schemas/CartItem'
          description: Cart items
        subtotal:
          type: number
          example: 103.96
          description: Subtotal before discounts and delivery
        deliveryCost:
          type: number
          example: 400
          description: Delivery cost in LKR
        discount:
          type: object
          properties:
            code:
              type: string
              example: "SAVE10"
              description: Discount code
            amount:
              type: number
              example: 10
              description: Discount amount
            type:
              type: string
              enum: [percentage, fixed]
              example: "percentage"
              description: Discount type
            appliedAt:
              type: string
              format: date-time
              example: 2024-01-15T10:30:00Z
              description: When discount was applied
        totalAmount:
          type: number
          example: 493.96
          description: Total amount including delivery and discounts
        itemCount:
          type: integer
          example: 2
          description: Number of items in cart
        currency:
          type: string
          example: "LKR"
          description: Currency code
        expiresAt:
          type: string
          format: date-time
          example: 2024-02-14T10:30:00Z
          description: Cart expiration date
        createdAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When cart was created
        updatedAt:
          type: string
          format: date-time
          example: 2024-01-15T10:30:00Z
          description: When cart was last updated

    AddToCartRequest:
      type: object
      required:
        - productId
        - variant
      properties:
        productId:
          type: string
          description: Product ID
          example: 507f1f77bcf86cd799439012
        variant:
          type: object
          required:
            - sku
            - size
            - color
          properties:
            sku:
              type: string
              example: "TSHIRT-M-BLUE-001"
              description: Product variant SKU
            size:
              type: string
              example: "M"
              description: Product size
            color:
              type: object
              required:
                - name
              properties:
                name:
                  type: string
                  example: "Blue"
                  description: Color name
                hex:
                  type: string
                  example: "#0000FF"
                  description: Color hex code
        quantity:
          type: integer
          minimum: 1
          maximum: 10
          default: 1
          example: 2
          description: Quantity to add

    UpdateQuantityRequest:
      type: object
      required:
        - quantity
      properties:
        quantity:
          type: integer
          minimum: 1
          maximum: 10
          example: 3
          description: New quantity

    ApplyDiscountRequest:
      type: object
      required:
        - discountCode
      properties:
        discountCode:
          type: string
          maxLength: 50
          example: "SAVE10"
          description: Discount code to apply

    CartSummary:
      type: object
      properties:
        itemCount:
          type: integer
          example: 2
          description: Number of items in cart
        subtotal:
          type: number
          example: 103.96
          description: Subtotal before discounts and delivery
        deliveryCost:
          type: number
          example: 400
          description: Delivery cost
        discount:
          type: object
          properties:
            code:
              type: string
              example: "SAVE10"
            amount:
              type: number
              example: 10
            type:
              type: string
              enum: [percentage, fixed]
              example: "percentage"
        totalAmount:
          type: number
          example: 493.96
          description: Total amount
        currency:
          type: string
          example: "LKR"
          description: Currency code
        items:
          type: array
          items:
            type: object
            properties:
              id:
                type: string
                example: 507f1f77bcf86cd799439011
              product:
                type: object
                properties:
                  id:
                    type: string
                    example: 507f1f77bcf86cd799439012
                  name:
                    type: string
                    example: "Cotton T-Shirt"
                  brand:
                    type: string
                    example: "TrendBite"
                  image:
                    type: string
                    example: "https://example.com/image.jpg"
              variant:
                type: object
                properties:
                  size:
                    type: string
                    example: "M"
                  color:
                    type: object
                    properties:
                      name:
                        type: string
                        example: "Blue"
                      hex:
                        type: string
                        example: "#0000FF"
                  sku:
                    type: string
                    example: "TSHIRT-M-BLUE-001"
              quantity:
                type: integer
                example: 2
              unitPrice:
                type: number
                example: 25.99
              totalPrice:
                type: number
                example: 51.98
        invalidItems:
          type: array
          description: Items that were removed due to unavailability
          items:
            type: object
            properties:
              itemId:
                type: string
                example: 507f1f77bcf86cd799439011
              reason:
                type: string
                example: "Product out of stock"

    # Delivery Management Schemas
    DeliveryPersonWithStats:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Delivery person ID
        firstName:
          type: string
          example: John
          description: First name
        lastName:
          type: string
          example: Doe
          description: Last name
        email:
          type: string
          example: john.doe@example.com
          description: Email address
        phone:
          type: string
          example: "+1234567890"
          description: Phone number
        role:
          type: string
          example: deliveryperson
          description: User role
        isActive:
          type: boolean
          example: true
          description: Whether the delivery person is active
        createdAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
          description: Account creation date
        updatedAt:
          type: string
          format: date-time
          example: "2023-01-01T00:00:00.000Z"
          description: Last update date
        stats:
          $ref: '#/components/schemas/DeliveryPersonStats'

    DeliveryStats:
      type: object
      properties:
        totalAssigned:
          type: integer
          example: 150
          description: Total number of orders assigned
        totalDelivered:
          type: integer
          example: 120
          description: Total number of orders delivered
        totalCompleted:
          type: integer
          example: 115
          description: Total number of orders completed
        averageDeliveryTime:
          type: number
          example: 3600000
          description: Average delivery time in milliseconds

    DeliveryPersonStats:
      type: object
      properties:
        _id:
          type: string
          example: 507f1f77bcf86cd799439011
          description: Delivery person ID
        deliveryPersonName:
          type: string
          example: "John Doe"
          description: Full name of delivery person
        totalAssigned:
          type: integer
          example: 25
          description: Total orders assigned to this person
        totalDelivered:
          type: integer
          example: 20
          description: Total orders delivered by this person
        totalCompleted:
          type: integer
          example: 18
          description: Total orders completed by this person
        averageDeliveryTime:
          type: number
          example: 3000000
          description: Average delivery time in milliseconds
        deliveryRate:
          type: number
          example: 80.0
          description: Delivery success rate percentage
        averageRating:
          type: number
          example: 4.8
          description: Average delivery rating from customers
        totalRatings:
          type: integer
          example: 157
          description: Total number of ratings received
        totalDeliveriesCount:
          type: integer
          example: 200
          description: Total deliveries completed

    OrderResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
          description: Indicates if the request was successful
        message:
          type: string
          example: "Operation completed successfully"
          description: Response message
        data:
          $ref: '#/components/schemas/Order'

    Payment:
      type: object
      properties:
        _id:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j1"
          description: Payment ID
        order:
          type: object
          properties:
            _id:
              type: string
              example: "64f1a2b3c4d5e6f7g8h9i0j2"
            orderNumber:
              type: string
              example: "TB000001"
            status:
              type: string
              example: "delivered"
            totalAmount:
              type: number
              example: 2500.00
            deliveryAddress:
              type: object
              properties:
                street:
                  type: string
                  example: "123 Main St"
                city:
                  type: string
                  example: "Colombo"
                state:
                  type: string
                  example: "Western"
                zipCode:
                  type: string
                  example: "10000"
        customer:
          type: object
          properties:
            _id:
              type: string
              example: "64f1a2b3c4d5e6f7g8h9i0j3"
            firstName:
              type: string
              example: "John"
            lastName:
              type: string
              example: "Doe"
            email:
              type: string
              example: "john@example.com"
            phone:
              type: string
              example: "+94123456789"
        deliveryPerson:
          type: object
          properties:
            _id:
              type: string
              example: "64f1a2b3c4d5e6f7g8h9i0j4"
            firstName:
              type: string
              example: "Mike"
            lastName:
              type: string
              example: "Johnson"
        expectedAmount:
          type: number
          example: 2500.00
          description: Expected payment amount
        collectedAmount:
          type: number
          example: 0
          description: Amount collected so far
        balanceAmount:
          type: number
          example: 2500.00
          description: Outstanding balance
        status:
          type: string
          enum: [pending, paid_on_delivery, completed, failed, partial]
          example: "pending"
          description: Payment status
        collectionStatus:
          type: string
          enum: [not_collected, collected, partial_collected, failed_collection]
          example: "not_collected"
          description: Collection status
        method:
          type: string
          example: "cash_on_delivery"
          description: Payment method
        collectionIssues:
          type: array
          items:
            type: string
            enum: [customer_not_available, customer_refused, address_incorrect, insufficient_cash, other]
          example: []
          description: Collection issues encountered
        issueDescription:
          type: string
          example: ""
          description: Description of collection issues
        deliveryAttempts:
          type: integer
          example: 0
          description: Number of delivery attempts
        lastAttemptDate:
          type: string
          format: date-time
          example: "2023-12-15T16:00:00Z"
          description: Last delivery attempt date
        collectionTimestamp:
          type: string
          format: date-time
          example: "2023-12-15T14:30:00Z"
          description: Payment collection timestamp
        collectionNotes:
          type: string
          example: "Customer paid exact amount in cash"
          description: Collection notes
        adminNotes:
          type: string
          example: ""
          description: Admin notes
        isOutstanding:
          type: boolean
          example: true
          description: Whether payment is outstanding
        createdAt:
          type: string
          format: date-time
          example: "2023-12-15T10:00:00Z"
        updatedAt:
          type: string
          format: date-time
          example: "2023-12-15T10:00:00Z"

    PaymentStatistics:
      type: object
      properties:
        totalPayments:
          type: integer
          example: 125
          description: Total number of payments
        totalExpectedAmount:
          type: number
          example: 125000.50
          description: Total expected amount
        totalCollectedAmount:
          type: number
          example: 110000.25
          description: Total collected amount
        totalOutstanding:
          type: integer
          example: 15
          description: Total outstanding payments
        totalOutstandingAmount:
          type: number
          example: 15000.25
          description: Total outstanding amount
        completedPayments:
          type: integer
          example: 110
          description: Number of completed payments
        partialPayments:
          type: integer
          example: 5
          description: Number of partial payments
        failedPayments:
          type: integer
          example: 10
          description: Number of failed payments
        outstandingCount:
          type: integer
          example: 15
          description: Count of outstanding payments
        collectionRate:
          type: number
          example: 88.0
          description: Collection rate percentage

    PaymentActivity:
      type: object
      properties:
        _id:
          type: string
          example: "64f1a2b3c4d5e6f7g8h9i0j1"
        order:
          type: object
          properties:
            orderNumber:
              type: string
              example: "TB000002"
        customer:
          type: object
          properties:
            firstName:
              type: string
              example: "Jane"
            lastName:
              type: string
              example: "Smith"
        deliveryPerson:
          type: object
          properties:
            firstName:
              type: string
              example: "Mike"
            lastName:
              type: string
              example: "Johnson"
        collectedAmount:
          type: number
          example: 1800.00
        collectionTimestamp:
          type: string
          format: date-time
          example: "2023-12-15T14:30:00Z"

    DeliveryRating:
      type: object
      properties:
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
          description: Rating from 1 to 5 stars
        feedback:
          type: string
          maxLength: 500
          example: "Excellent service! Very professional and on time."
          description: Customer feedback text
        ratedAt:
          type: string
          format: date-time
          example: "2025-10-10T10:30:00.000Z"
          description: When the rating was submitted

    RatingDistribution:
      type: object
      properties:
        "5":
          type: integer
          example: 121
          description: Number of 5-star ratings
        "4":
          type: integer
          example: 25
          description: Number of 4-star ratings
        "3":
          type: integer
          example: 8
          description: Number of 3-star ratings
        "2":
          type: integer
          example: 2
          description: Number of 2-star ratings
        "1":
          type: integer
          example: 1
          description: Number of 1-star ratings

    DeliveryRatingDetail:
      type: object
      properties:
        orderId:
          type: string
          example: "654321abcdef123456789012"
          description: Order ID
        orderNumber:
          type: string
          example: "TB000123"
          description: Order number
        customer:
          type: object
          properties:
            name:
              type: string
              example: "Jane Smith"
              description: Customer name
            avatar:
              type: object
              properties:
                url:
                  type: string
                  example: "https://cloudinary.com/avatar.jpg"
                  description: Customer avatar URL
        rating:
          type: integer
          minimum: 1
          maximum: 5
          example: 5
          description: Delivery rating
        feedback:
          type: string
          example: "Excellent service!"
          description: Customer feedback
        ratedAt:
          type: string
          format: date-time
          example: "2025-10-10T10:30:00.000Z"
          description: When rating was submitted

    DeliveryPersonWithRatings:
      type: object
      properties:
        id:
          type: string
          example: "123456abcdef123456789012"
          description: Delivery person ID
        name:
          type: string
          example: "John Doe"
          description: Full name
        email:
          type: string
          example: "john.doe@example.com"
          description: Email address
        phone:
          type: string
          example: "+94771234567"
          description: Phone number
        avatar:
          type: object
          properties:
            url:
              type: string
              example: "https://cloudinary.com/avatar.jpg"
              description: Avatar URL
        stats:
          type: object
          properties:
            averageRating:
              type: number
              example: 4.8
              description: Average delivery rating
            totalRatings:
              type: integer
              example: 157
              description: Total number of ratings received
            totalDeliveries:
              type: integer
              example: 200
              description: Total deliveries completed
            totalOrders:
              type: integer
              example: 215
              description: Total orders assigned
            deliveredOrders:
              type: integer
              example: 200
              description: Successfully delivered orders
            pendingOrders:
              type: integer
              example: 5
              description: Current pending orders
            deliveryRate:
              type: number
              example: 93.0
              description: Delivery success rate percentage

  responses:
    UnauthorizedError:
      description: Authentication information is missing or invalid
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
                description: Indicates if the request was successful
              message:
                type: string
                example: "Unauthorized access"
                description: Error message
              error:
                type: string
                example: "Authentication required"
                description: Detailed error information

    ForbiddenError:
      description: Access to the requested resource is forbidden
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
                description: Indicates if the request was successful
              message:
                type: string
                example: "Access forbidden"
                description: Error message
              error:
                type: string
                example: "Insufficient permissions"
                description: Detailed error information

    InternalServerError:
      description: Internal server error occurred
      content:
        application/json:
          schema:
            type: object
            properties:
              success:
                type: boolean
                example: false
                description: Indicates if the request was successful
              message:
                type: string
                example: "Internal server error"
                description: Error message
              error:
                type: string
                example: "Something went wrong on our end"
                description: Detailed error information

security:
  - bearerAuth: []
